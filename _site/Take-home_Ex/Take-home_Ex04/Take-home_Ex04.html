<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Michael Djohan">
<meta name="dcterms.date" content="2023-02-19">

<title>Visual Analytics - Michael Djohan - Take-home Exercise 4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Take-home Exercise 4</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      <img src="../../images/icon.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://github.com/michaeldjo/ISSS608-VAA" title="" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="../../www.linkedin.com/in/michaelkevindjohan" title="" class="sidebar-tool px-1"><i class="bi bi-linkedin"></i></a>
</div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">About this website</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">Home</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../about.html" class="sidebar-item-text sidebar-link">About</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">Hands-on Exercise</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01.html" class="sidebar-item-text sidebar-link">Hands-on Exercise 1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02.html" class="sidebar-item-text sidebar-link">Hands-on Exercise 2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03.html" class="sidebar-item-text sidebar-link">Hands-on Exercise 3</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04.html" class="sidebar-item-text sidebar-link">Hands-on Exercise 4</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05.html" class="sidebar-item-text sidebar-link">Ternary Plot</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-on_Ex/Hands-on_Ex05.1/Hands-on_Ex05.1.html" class="sidebar-item-text sidebar-link">Hands-on Exercise 5</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex06.html" class="sidebar-item-text sidebar-link">Hands-on Exercise 6</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">In-Class Exercise</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../In-class_Ex/In-class_Ex03/In-class_Ex03.html" class="sidebar-item-text sidebar-link">In-class Exercise 3</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../In-class_Ex/In-class_Ex04/In-class_Ex04.html" class="sidebar-item-text sidebar-link">In-class Exercise 4</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../In-class_Ex/In-class_Ex05/In-class_Ex05.html" class="sidebar-item-text sidebar-link">In-class Exercise 5</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">Take-home Exercise</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Take-home_Ex/Take-home_Ex01/Take-home_Ex01.html" class="sidebar-item-text sidebar-link">Take-home Exercise 1</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Take-home_Ex/Take-home_Ex02/Take-home_Ex02.html" class="sidebar-item-text sidebar-link">Take-home Exercise 2</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Take-home_Ex/Take-home_Ex03/Take-home_Ex03.html" class="sidebar-item-text sidebar-link">Take-home Exercise 3</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><strong>1. Overview</strong></a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation"><strong>2. Data Preparation</strong></a>
  <ul>
  <li><a href="#install-r-packages-and-import-dataset" id="toc-install-r-packages-and-import-dataset" class="nav-link" data-scroll-target="#install-r-packages-and-import-dataset">2.1 Install R packages and import dataset</a></li>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning">2.2 Data cleaning</a>
  <ul>
  <li><a href="#cleaning-the-countries-data-for-sgimport-and-sgexport" id="toc-cleaning-the-countries-data-for-sgimport-and-sgexport" class="nav-link" data-scroll-target="#cleaning-the-countries-data-for-sgimport-and-sgexport">2.2.1 Cleaning the countries data for <strong><em>sgimport</em></strong> and <strong><em>sgexport</em></strong></a></li>
  <li><a href="#pivot-and-transform-tibbles-to-time-series-layout" id="toc-pivot-and-transform-tibbles-to-time-series-layout" class="nav-link" data-scroll-target="#pivot-and-transform-tibbles-to-time-series-layout">2.2.2 Pivot and transform tibbles to time-series layout</a></li>
  <li><a href="#finding-the-discrepancies-between-sgimport_cln-and-sgexport_cln" id="toc-finding-the-discrepancies-between-sgimport_cln-and-sgexport_cln" class="nav-link" data-scroll-target="#finding-the-discrepancies-between-sgimport_cln-and-sgexport_cln">2.2.3 Finding the discrepancies between <strong><em>sgimport_cln</em></strong> and <strong><em>sgexport_cln</em></strong></a></li>
  <li><a href="#joining-the-two-tibbles-and-calculate-trade-balance-and-volume" id="toc-joining-the-two-tibbles-and-calculate-trade-balance-and-volume" class="nav-link" data-scroll-target="#joining-the-two-tibbles-and-calculate-trade-balance-and-volume">2.2.4 Joining the two tibbles and calculate trade balance and volume</a></li>
  <li><a href="#finding-top-countries-by-trade-volume" id="toc-finding-top-countries-by-trade-volume" class="nav-link" data-scroll-target="#finding-top-countries-by-trade-volume">2.2.5 Finding top countries by trade volume</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#visualisation" id="toc-visualisation" class="nav-link" data-scroll-target="#visualisation"><strong>3. Visualisation</strong></a>
  <ul>
  <li><a href="#exploratory-data-visualisation" id="toc-exploratory-data-visualisation" class="nav-link" data-scroll-target="#exploratory-data-visualisation">3.1 Exploratory Data Visualisation</a>
  <ul>
  <li><a href="#sec-3.1.1" id="toc-sec-3.1.1" class="nav-link" data-scroll-target="#sec-3.1.1">3.1.1 Overall Singapore Trade Balance Performance</a>
  <ul class="collapse">
  <li><a href="#sec-3.1.1.1" id="toc-sec-3.1.1.1" class="nav-link" data-scroll-target="#sec-3.1.1.1">3.1.1.1 Design Consideration</a></li>
  <li><a href="#sec-3.1.1.2" id="toc-sec-3.1.1.2" class="nav-link" data-scroll-target="#sec-3.1.1.2">3.1.1.2 Preparation of visualisation</a></li>
  <li><a href="#sec-3.1.1.3" id="toc-sec-3.1.1.3" class="nav-link" data-scroll-target="#sec-3.1.1.3">3.1.1.3 Insights</a></li>
  </ul></li>
  <li><a href="#overview-of-singapore-trade-balance-by-countries" id="toc-overview-of-singapore-trade-balance-by-countries" class="nav-link" data-scroll-target="#overview-of-singapore-trade-balance-by-countries">3.1.2 Overview of Singapore Trade Balance by Countries</a>
  <ul class="collapse">
  <li><a href="#design-consideration" id="toc-design-consideration" class="nav-link" data-scroll-target="#design-consideration">3.1.2.1 Design Consideration</a></li>
  <li><a href="#preparation-of-visualisation" id="toc-preparation-of-visualisation" class="nav-link" data-scroll-target="#preparation-of-visualisation">3.1.2.2 Preparation of visualisation</a></li>
  <li><a href="#insights" id="toc-insights" class="nav-link" data-scroll-target="#insights">3.1.2.3 Insights</a></li>
  <li><a href="#sec-3.1.2.4" id="toc-sec-3.1.2.4" class="nav-link" data-scroll-target="#sec-3.1.2.4">3.1.2.4 Selecting Countries for further analysis</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#bi-lateral-trade-of-singapore-against-selected-partners" id="toc-bi-lateral-trade-of-singapore-against-selected-partners" class="nav-link" data-scroll-target="#bi-lateral-trade-of-singapore-against-selected-partners">3.2 Bi-lateral Trade of Singapore against selected partners</a>
  <ul>
  <li><a href="#singapore-trade-performance-on-monthly-basis" id="toc-singapore-trade-performance-on-monthly-basis" class="nav-link" data-scroll-target="#singapore-trade-performance-on-monthly-basis">3.2.1 Singapore Trade Performance on Monthly basis</a>
  <ul class="collapse">
  <li><a href="#design-consideration-1" id="toc-design-consideration-1" class="nav-link" data-scroll-target="#design-consideration-1">3.2.2.1 Design Consideration</a></li>
  <li><a href="#preparation-of-visualisation-1" id="toc-preparation-of-visualisation-1" class="nav-link" data-scroll-target="#preparation-of-visualisation-1">3.2.2.2 Preparation of visualisation</a></li>
  <li><a href="#insight" id="toc-insight" class="nav-link" data-scroll-target="#insight">3.2.2.3 Insight</a></li>
  </ul></li>
  <li><a href="#singapore-trade-performance-with-selected-countries" id="toc-singapore-trade-performance-with-selected-countries" class="nav-link" data-scroll-target="#singapore-trade-performance-with-selected-countries">3.2.2 Singapore Trade Performance with Selected Countries</a>
  <ul class="collapse">
  <li><a href="#design-consideration-2" id="toc-design-consideration-2" class="nav-link" data-scroll-target="#design-consideration-2">3.2.2.1 Design Consideration</a></li>
  <li><a href="#preparation-of-visualisation-2" id="toc-preparation-of-visualisation-2" class="nav-link" data-scroll-target="#preparation-of-visualisation-2">3.2.2.2 Preparation of visualisation</a></li>
  <li><a href="#insights-1" id="toc-insights-1" class="nav-link" data-scroll-target="#insights-1">3.2.2.3 Insights</a></li>
  </ul></li>
  <li><a href="#year-over-year-changes-between-2020-and-2022" id="toc-year-over-year-changes-between-2020-and-2022" class="nav-link" data-scroll-target="#year-over-year-changes-between-2020-and-2022">3.2.3 Year-over-Year changes between 2020 and 2022</a></li>
  </ul></li>
  <li><a href="#changes-in-import-and-export-over-time" id="toc-changes-in-import-and-export-over-time" class="nav-link" data-scroll-target="#changes-in-import-and-export-over-time">3.3 Changes in Import and Export over time</a>
  <ul>
  <li><a href="#data-preparation-4" id="toc-data-preparation-4" class="nav-link" data-scroll-target="#data-preparation-4">3.3.1 Data Preparation</a></li>
  <li><a href="#building-the-plot" id="toc-building-the-plot" class="nav-link" data-scroll-target="#building-the-plot">3.3.2 Building the plot</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Take-home Exercise 4</h1>
<p class="subtitle lead">Singapore bi-lateral trade performance in 2020 to 2022</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Michael Djohan </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 19, 2023</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">February 22, 2023</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview"><strong>1. Overview</strong></h2>
<p>This exercise aims to uncover the impact of COVID-19, global economic and political dynamic in 2022 on Singapore bi-lateral trade using time-series visualisation. The visualization is designed using <code>ggplot2</code>, its extensions, and <code>tidyverse</code> packages.</p>
<p>The original Merchandise Trade dataset was downloaded from <a href="https://www.singstat.gov.sg/find-data/search-by-theme/trade-and-investment/merchandise-trade/latest-data">Department of Statistics</a> titled <em>Merchandise Trade by Region/Market</em></p>
<p>The file downloaded was <em>outputFile.xlsx</em></p>
<p>The study period is from for <strong>January 2020 to December 2022</strong> period.</p>
</section>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation"><strong>2. Data Preparation</strong></h2>
<section id="install-r-packages-and-import-dataset" class="level3">
<h3 class="anchored" data-anchor-id="install-r-packages-and-import-dataset">2.1 Install R packages and import dataset</h3>
<p>The code chunk below uses <code>pacman::p_load()</code> to check if packages are installed. If they are, they will be launched into R. The packages installed are</p>
<ul>
<li><p><code>readxl</code>: Used to read data from excel files</p></li>
<li><p><code>knitr</code>: Used for dynamic report generation</p></li>
<li><p><code>lubridate</code>: Used to work with date and time</p></li>
<li><p><code>ggHoriPlot</code>: Used to creating horizon plot</p></li>
<li><p><code>ggthemes</code>: Provide additional themes for <code>ggplot2</code></p></li>
<li><p><code>patchwork</code>: Used to combine plots</p></li>
<li><p><code>directlabels</code>: Add labels directly to plots</p></li>
<li><p><code>ggbraid</code>: Used to create braided ribbons plot. <code>remotes::install_github("nsgrantham/ggbraid")</code> is used to install the package.</p></li>
<li><p><code>CGPfunctions</code>: Contains <code>newggslopegraph</code> to plot slope graph</p></li>
<li><p><code>ggtext</code>: Used to improve text rendering support for <code>ggplot2</code></p></li>
<li><p><code>gganimate</code>: Used to create animated plot</p></li>
<li><p><code>ggifski</code>: Makes smooth GIF animations for rendering of <code>gganimate</code></p></li>
<li><p><code>scales</code>: Used to rescale and modify labels display</p></li>
<li><p><code>tidyverse</code>: A collection of core packages designed for data science, used extensively for data preparation and wrangling.</p>
<p>All packages can be found within CRAN, except for <code>ggbraid</code>.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(readxl, knitr, lubridate, ggHoriPlot, ggthemes, patchwork, directlabels, ggbraid, CGPfunctions, ggtext, gganimate, gifski, scales, tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Import data from excel file using <code>readxl::read_excel()</code> and store it in tibble <em><strong>sgimport</strong> and <strong>sgexport</strong></em>.</p>
<p>Note that by choosing the specific range, the period of interest (January 2020 to December 2022) is manually selected.</p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Upon inspection of the excel file, it is noted that <strong><em>sgexport</em></strong> rows are smaller than <strong><em>sgimport</em></strong>, extending to row 101 instead of 129.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Import data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>sgimport <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/outputFile.xlsx"</span>, <span class="at">sheet =</span> <span class="st">"T1"</span>, <span class="at">range =</span> <span class="st">"A10:AK129"</span> )</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>sgexport <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/outputFile.xlsx"</span>, <span class="at">sheet =</span> <span class="st">"T2"</span>, <span class="at">range =</span> <span class="st">"A10:AK101"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Additional data is downloaded from <a href="https://data.worldbank.org/country">World Bank</a> dataset which lists countries by world regions.</p>
<p>Import data from excel file using <code>readr::read_csv()</code> and store it in tibble <strong><em>regions</em></strong>.</p>
<p>This Entity and World_RegionbyWorld_Bank variable is renamed to Countries and Region for easier interpretation and future joins with other tibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>regions <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/world-regions-according-to-the-world-bank.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Countries =</span> Entity,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Region =</span> World_RegionbyWorld_Bank) <span class="sc">|&gt;</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Countries, Region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="section" class="level6">
<h6 class="anchored" data-anchor-id="section"></h6>
</section>
</section>
<section id="data-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="data-cleaning">2.2 Data cleaning</h3>
<p>Scope of the study is to understand bi-lateral trade of Singapore with countries / trade partners around the world. Hence, we will not include regions (i.e., Asia, Africa) or collection of countries (i.e., European Union or Other Countries In Oceania).</p>
<section id="cleaning-the-countries-data-for-sgimport-and-sgexport" class="level4">
<h4 class="anchored" data-anchor-id="cleaning-the-countries-data-for-sgimport-and-sgexport">2.2.1 Cleaning the countries data for <strong><em>sgimport</em></strong> and <strong><em>sgexport</em></strong></h4>
<p>Looking at the <strong><em>sgimport</em></strong> tibble below, we notice few problems</p>
<ul>
<li><p>The layout of the tibble is not apt for time series. Ideally the time period needs to be in rows with the countries in column</p></li>
<li><p>The column names are in string format and needs to be converted to datetime format</p></li>
<li><p><strong>Data Series</strong> contain not only countries/trade partners, but also regions or collection of countries</p></li>
<li><p>The countries name contain string suffix ‘(Thousand Dollars)’ and the values are in (’000) format</p></li>
</ul>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Similar issue is also observed with <strong><em>sgexport</em></strong></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(sgimport))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 10%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Data Series</th>
<th style="text-align: right;">2022 Dec</th>
<th style="text-align: right;">2022 Nov</th>
<th style="text-align: right;">2022 Oct</th>
<th style="text-align: right;">2022 Sep</th>
<th style="text-align: right;">2022 Aug</th>
<th style="text-align: right;">2022 Jul</th>
<th style="text-align: right;">2022 Jun</th>
<th style="text-align: right;">2022 May</th>
<th style="text-align: right;">2022 Apr</th>
<th style="text-align: right;">2022 Mar</th>
<th style="text-align: right;">2022 Feb</th>
<th style="text-align: right;">2022 Jan</th>
<th style="text-align: right;">2021 Dec</th>
<th style="text-align: right;">2021 Nov</th>
<th style="text-align: right;">2021 Oct</th>
<th style="text-align: right;">2021 Sep</th>
<th style="text-align: right;">2021 Aug</th>
<th style="text-align: right;">2021 Jul</th>
<th style="text-align: right;">2021 Jun</th>
<th style="text-align: right;">2021 May</th>
<th style="text-align: right;">2021 Apr</th>
<th style="text-align: right;">2021 Mar</th>
<th style="text-align: right;">2021 Feb</th>
<th style="text-align: right;">2021 Jan</th>
<th style="text-align: right;">2020 Dec</th>
<th style="text-align: right;">2020 Nov</th>
<th style="text-align: right;">2020 Oct</th>
<th style="text-align: right;">2020 Sep</th>
<th style="text-align: right;">2020 Aug</th>
<th style="text-align: right;">2020 Jul</th>
<th style="text-align: right;">2020 Jun</th>
<th style="text-align: right;">2020 May</th>
<th style="text-align: right;">2020 Apr</th>
<th style="text-align: right;">2020 Mar</th>
<th style="text-align: right;">2020 Feb</th>
<th style="text-align: right;">2020 Jan</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Total Merchandise Imports (Thousand Dollars)</td>
<td style="text-align: right;">49869770.0</td>
<td style="text-align: right;">50653907.0</td>
<td style="text-align: right;">53182943.0</td>
<td style="text-align: right;">55799312.0</td>
<td style="text-align: right;">58466009.0</td>
<td style="text-align: right;">61029374.0</td>
<td style="text-align: right;">59649162.0</td>
<td style="text-align: right;">57604263.0</td>
<td style="text-align: right;">56116002.0</td>
<td style="text-align: right;">58079982.0</td>
<td style="text-align: right;">44958373.0</td>
<td style="text-align: right;">50026788.0</td>
<td style="text-align: right;">54349357.0</td>
<td style="text-align: right;">50674908.0</td>
<td style="text-align: right;">47945213.0</td>
<td style="text-align: right;">45980374.0</td>
<td style="text-align: right;">44714491.0</td>
<td style="text-align: right;">46107788.0</td>
<td style="text-align: right;">45039845.0</td>
<td style="text-align: right;">41559697.0</td>
<td style="text-align: right;">45169547.0</td>
<td style="text-align: right;">47668437.0</td>
<td style="text-align: right;">37643664.0</td>
<td style="text-align: right;">39028616.0</td>
<td style="text-align: right;">40154550.0</td>
<td style="text-align: right;">38477878.0</td>
<td style="text-align: right;">38173829.0</td>
<td style="text-align: right;">38801413.0</td>
<td style="text-align: right;">36472279.0</td>
<td style="text-align: right;">37843646.0</td>
<td style="text-align: right;">35120892.0</td>
<td style="text-align: right;">31458238.0</td>
<td style="text-align: right;">35878828.0</td>
<td style="text-align: right;">40433029.0</td>
<td style="text-align: right;">39472637.0</td>
<td style="text-align: right;">41180224.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">America (Million Dollars)</td>
<td style="text-align: right;">6901.5</td>
<td style="text-align: right;">7529.4</td>
<td style="text-align: right;">7666.4</td>
<td style="text-align: right;">7995.9</td>
<td style="text-align: right;">8633.8</td>
<td style="text-align: right;">7879.7</td>
<td style="text-align: right;">8024.0</td>
<td style="text-align: right;">8521.1</td>
<td style="text-align: right;">7822.1</td>
<td style="text-align: right;">7176.1</td>
<td style="text-align: right;">5385.2</td>
<td style="text-align: right;">5850.9</td>
<td style="text-align: right;">6261.1</td>
<td style="text-align: right;">6127.4</td>
<td style="text-align: right;">6027.6</td>
<td style="text-align: right;">5631.6</td>
<td style="text-align: right;">5750.1</td>
<td style="text-align: right;">5728.6</td>
<td style="text-align: right;">5457.4</td>
<td style="text-align: right;">5191.8</td>
<td style="text-align: right;">6195.9</td>
<td style="text-align: right;">5303.5</td>
<td style="text-align: right;">4164.2</td>
<td style="text-align: right;">4580.0</td>
<td style="text-align: right;">4676.4</td>
<td style="text-align: right;">4588.2</td>
<td style="text-align: right;">4869.7</td>
<td style="text-align: right;">4886.4</td>
<td style="text-align: right;">4132.0</td>
<td style="text-align: right;">4667.3</td>
<td style="text-align: right;">4686.2</td>
<td style="text-align: right;">4259.0</td>
<td style="text-align: right;">5183.5</td>
<td style="text-align: right;">5910.8</td>
<td style="text-align: right;">5314.1</td>
<td style="text-align: right;">5844.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Asia (Million Dollars)</td>
<td style="text-align: right;">33611.7</td>
<td style="text-align: right;">34733.7</td>
<td style="text-align: right;">36120.9</td>
<td style="text-align: right;">37696.3</td>
<td style="text-align: right;">40911.9</td>
<td style="text-align: right;">43214.2</td>
<td style="text-align: right;">42507.2</td>
<td style="text-align: right;">40534.7</td>
<td style="text-align: right;">38735.7</td>
<td style="text-align: right;">42199.9</td>
<td style="text-align: right;">31611.3</td>
<td style="text-align: right;">35014.0</td>
<td style="text-align: right;">39140.3</td>
<td style="text-align: right;">35949.6</td>
<td style="text-align: right;">33552.7</td>
<td style="text-align: right;">32533.4</td>
<td style="text-align: right;">31492.5</td>
<td style="text-align: right;">31645.0</td>
<td style="text-align: right;">31021.0</td>
<td style="text-align: right;">28497.2</td>
<td style="text-align: right;">30623.1</td>
<td style="text-align: right;">31367.8</td>
<td style="text-align: right;">26122.6</td>
<td style="text-align: right;">27413.7</td>
<td style="text-align: right;">28200.4</td>
<td style="text-align: right;">25844.9</td>
<td style="text-align: right;">26127.9</td>
<td style="text-align: right;">27823.2</td>
<td style="text-align: right;">26052.3</td>
<td style="text-align: right;">26767.4</td>
<td style="text-align: right;">24779.3</td>
<td style="text-align: right;">21718.9</td>
<td style="text-align: right;">24534.5</td>
<td style="text-align: right;">26783.6</td>
<td style="text-align: right;">26588.1</td>
<td style="text-align: right;">27128.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Europe (Million Dollars)</td>
<td style="text-align: right;">7541.8</td>
<td style="text-align: right;">7242.8</td>
<td style="text-align: right;">7475.9</td>
<td style="text-align: right;">8167.6</td>
<td style="text-align: right;">7433.2</td>
<td style="text-align: right;">8300.5</td>
<td style="text-align: right;">7300.2</td>
<td style="text-align: right;">7030.8</td>
<td style="text-align: right;">7407.2</td>
<td style="text-align: right;">7203.2</td>
<td style="text-align: right;">6479.0</td>
<td style="text-align: right;">7821.6</td>
<td style="text-align: right;">7586.3</td>
<td style="text-align: right;">6872.0</td>
<td style="text-align: right;">6714.8</td>
<td style="text-align: right;">6882.1</td>
<td style="text-align: right;">5919.4</td>
<td style="text-align: right;">6919.2</td>
<td style="text-align: right;">7011.2</td>
<td style="text-align: right;">6563.5</td>
<td style="text-align: right;">6740.5</td>
<td style="text-align: right;">8964.0</td>
<td style="text-align: right;">5403.7</td>
<td style="text-align: right;">5749.6</td>
<td style="text-align: right;">6087.4</td>
<td style="text-align: right;">6133.5</td>
<td style="text-align: right;">6285.4</td>
<td style="text-align: right;">5316.9</td>
<td style="text-align: right;">5225.0</td>
<td style="text-align: right;">5475.3</td>
<td style="text-align: right;">4960.7</td>
<td style="text-align: right;">4629.0</td>
<td style="text-align: right;">5150.6</td>
<td style="text-align: right;">6333.3</td>
<td style="text-align: right;">6209.6</td>
<td style="text-align: right;">6859.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Oceania (Million Dollars)</td>
<td style="text-align: right;">1399.9</td>
<td style="text-align: right;">664.4</td>
<td style="text-align: right;">1329.8</td>
<td style="text-align: right;">1544.6</td>
<td style="text-align: right;">935.9</td>
<td style="text-align: right;">1060.6</td>
<td style="text-align: right;">1141.8</td>
<td style="text-align: right;">1164.7</td>
<td style="text-align: right;">1559.1</td>
<td style="text-align: right;">863.9</td>
<td style="text-align: right;">814.4</td>
<td style="text-align: right;">810.4</td>
<td style="text-align: right;">744.8</td>
<td style="text-align: right;">994.1</td>
<td style="text-align: right;">1021.2</td>
<td style="text-align: right;">599.8</td>
<td style="text-align: right;">744.0</td>
<td style="text-align: right;">1201.2</td>
<td style="text-align: right;">890.1</td>
<td style="text-align: right;">1001.7</td>
<td style="text-align: right;">1030.5</td>
<td style="text-align: right;">1131.0</td>
<td style="text-align: right;">1134.7</td>
<td style="text-align: right;">705.5</td>
<td style="text-align: right;">540.9</td>
<td style="text-align: right;">1412.8</td>
<td style="text-align: right;">577.3</td>
<td style="text-align: right;">477.7</td>
<td style="text-align: right;">586.5</td>
<td style="text-align: right;">493.1</td>
<td style="text-align: right;">456.4</td>
<td style="text-align: right;">441.8</td>
<td style="text-align: right;">637.6</td>
<td style="text-align: right;">845.9</td>
<td style="text-align: right;">694.7</td>
<td style="text-align: right;">819.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">Africa (Million Dollars)</td>
<td style="text-align: right;">414.9</td>
<td style="text-align: right;">483.6</td>
<td style="text-align: right;">589.9</td>
<td style="text-align: right;">395.0</td>
<td style="text-align: right;">551.2</td>
<td style="text-align: right;">574.4</td>
<td style="text-align: right;">675.9</td>
<td style="text-align: right;">352.9</td>
<td style="text-align: right;">591.9</td>
<td style="text-align: right;">636.9</td>
<td style="text-align: right;">668.5</td>
<td style="text-align: right;">529.9</td>
<td style="text-align: right;">616.8</td>
<td style="text-align: right;">731.8</td>
<td style="text-align: right;">628.8</td>
<td style="text-align: right;">333.4</td>
<td style="text-align: right;">808.4</td>
<td style="text-align: right;">613.8</td>
<td style="text-align: right;">660.2</td>
<td style="text-align: right;">305.4</td>
<td style="text-align: right;">579.6</td>
<td style="text-align: right;">902.2</td>
<td style="text-align: right;">818.5</td>
<td style="text-align: right;">579.9</td>
<td style="text-align: right;">649.4</td>
<td style="text-align: right;">498.6</td>
<td style="text-align: right;">313.5</td>
<td style="text-align: right;">297.2</td>
<td style="text-align: right;">476.5</td>
<td style="text-align: right;">440.6</td>
<td style="text-align: right;">238.2</td>
<td style="text-align: right;">409.6</td>
<td style="text-align: right;">372.6</td>
<td style="text-align: right;">559.4</td>
<td style="text-align: right;">666.1</td>
<td style="text-align: right;">528.6</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Before doing any pivoting, each individual tibble needs to be tidied up to avoid further complications. The code chunks below perform the required data wrangling to</p>
<ul>
<li><p>Remove the regions or collection of countries in <strong>Data Series</strong> variable by filtering the first 7 rows out. This is done using <code>dplyr::filter()</code></p></li>
<li><p>Remove the string ‘(Thousand Dollars)’ from each of the countries’ name in . This is done using <code>str_remove()</code> function in combination with regular expression <code>" \\(Thousand Dollars\\)"</code>. Assign this to new variable <strong>Countries</strong> using <code>dplyr::mutate()</code></p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the next section, we will multiply the values by 1000 to compensate for the loss of string suffix ‘(Thousand Dollars)’</p>
</div>
</div></li>
<li><p>Remove the old <strong>Data Series</strong> column</p></li>
</ul>
<p>The modified tibbles are stored in new tibbles <strong><em>sgimport_ctry</em></strong> and <strong><em>sgexport_ctry</em></strong> respectively</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>sgimport_ctry <span class="ot">&lt;-</span> sgimport <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#remove the first 7 rows, which are Total and non-countries</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#remove the '(Thousand Dollars)' string from column Data Series and call it Countries</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Countries =</span> <span class="fu">str_remove</span>(<span class="st">`</span><span class="at">Data Series</span><span class="st">`</span>, </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                                <span class="st">" </span><span class="sc">\\</span><span class="st">(Thousand Dollars</span><span class="sc">\\</span><span class="st">)"</span>), </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">.after =</span> <span class="st">`</span><span class="at">Data Series</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#remove 'Data Series' column</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Data Series</span><span class="st">`</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sgexport_ctry <span class="ot">&lt;-</span> sgexport <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#remove the first 7 rows, which are Total and non-countries</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#remove the '(Thousand Dollars)' string from column Data Series and call it Countries</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Countries =</span> <span class="fu">str_remove</span>(<span class="st">`</span><span class="at">Data Series</span><span class="st">`</span>, </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                                <span class="st">" </span><span class="sc">\\</span><span class="st">(Thousand Dollars</span><span class="sc">\\</span><span class="st">)"</span>), </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">.after =</span> <span class="st">`</span><span class="at">Data Series</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#remove 'Data Series' column</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Data Series</span><span class="st">`</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pivot-and-transform-tibbles-to-time-series-layout" class="level4">
<h4 class="anchored" data-anchor-id="pivot-and-transform-tibbles-to-time-series-layout">2.2.2 Pivot and transform tibbles to time-series layout</h4>
<p>Transforming <strong><em>sgimport_ctry</em></strong> and <strong><em>sgexport_ctry</em></strong> to time-series layout requires the help of <code>tidyr::pivot_longer()</code>, splitting the column string (i.e., ‘2022 Dec’) to <strong>Year</strong> and <strong>Month</strong> variables respectively. To do this, we will use the <code>names_sep</code> argument. The values are assigned to new variable <strong>Import_SGD</strong> and <strong>Export_SGD</strong> respectively.</p>
<p>Additionally, <code>dplyr::mutate()</code> will be used to</p>
<ul>
<li><p>Convert <strong>Month</strong> to factors, levelled based on the abbreviation (i.e., ‘Jan’). This will allow easy ordering during plotting</p></li>
<li><p>Convert <strong>Year</strong> to integer for the same purpose as month</p></li>
<li><p>Create new variable <strong>Month_Year</strong> which is in datetime format to allow time-series plotting. This is done using <code>lubridate::make_date()</code> function</p></li>
<li><p>Multiply the <strong>Import_SGD</strong> and <strong>Export_SGD</strong> values by 1000 to compensate for the loss of string suffix ‘(Thousand Dollars)’</p></li>
</ul>
<p>The modified tibbles are stored in new tibbles <strong><em>sgimport_cln</em></strong> and <strong><em>sgexport_cln</em></strong> respectively</p>
<p>See the resulting tibble below; only <strong><em>sgimport_cln</em></strong> is shown for illustrative purpose as similar treatment is done on <strong><em>sgexport_cln</em></strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sgimport_cln <span class="ot">&lt;-</span> sgimport_ctry <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#pivot_longer to get year and month timeseries</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">!</span>Countries,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"Month"</span>),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">" "</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Import_SGD"</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>               ) <span class="sc">|&gt;</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Convert Month to factors and Years to integers for ordering purposes</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">factor</span>(Month, <span class="at">levels =</span> month.abb),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">Year =</span> <span class="fu">as.integer</span>(Year),</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">Month_Year =</span> <span class="fu">make_date</span>(Year, Month),</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Multiply values by 1000</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Import_SGD =</span> Import_SGD<span class="sc">*</span><span class="dv">1000</span>) </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>sgimport_cln</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,032 × 5
   Month_Year Countries  Year Month Import_SGD
   &lt;date&gt;     &lt;chr&gt;     &lt;int&gt; &lt;fct&gt;      &lt;dbl&gt;
 1 2022-12-01 Belgium    2022 Dec    103655000
 2 2022-11-01 Belgium    2022 Nov    121773000
 3 2022-10-01 Belgium    2022 Oct     88796000
 4 2022-09-01 Belgium    2022 Sep    215978000
 5 2022-08-01 Belgium    2022 Aug    132917000
 6 2022-07-01 Belgium    2022 Jul    224676000
 7 2022-06-01 Belgium    2022 Jun    114704000
 8 2022-05-01 Belgium    2022 May    116817000
 9 2022-04-01 Belgium    2022 Apr    146603000
10 2022-03-01 Belgium    2022 Mar    319393000
# … with 4,022 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sgexport_cln <span class="ot">&lt;-</span> sgexport_ctry <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#pivot_longer to get year and month timeseries</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">!</span>Countries,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"Month"</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">" "</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Export_SGD"</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>               ) <span class="sc">|&gt;</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Convert Month and Year to factors for ordering purposes</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Multiply values by 1000</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">factor</span>(Month, <span class="at">levels =</span> month.abb),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">Year =</span> <span class="fu">as.integer</span>(Year),</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">Month_Year =</span> <span class="fu">make_date</span>(Year, Month),</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Export_SGD =</span> Export_SGD<span class="sc">*</span><span class="dv">1000</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="finding-the-discrepancies-between-sgimport_cln-and-sgexport_cln" class="level4">
<h4 class="anchored" data-anchor-id="finding-the-discrepancies-between-sgimport_cln-and-sgexport_cln">2.2.3 Finding the discrepancies between <strong><em>sgimport_cln</em></strong> and <strong><em>sgexport_cln</em></strong></h4>
<p>Before joining the two tibbles: <strong><em>sgimport_cln</em></strong> and <strong><em>sgexport_cln</em></strong>, it is important to recognise that their number of rows are not the same. To detect the difference, a tibble called <strong><em>import_vs_export</em></strong> is created below to list the countries which appear in <strong><em>sgimport_cln</em></strong> but not in <strong><em>sgexport_cln</em></strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>import_vs_export <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(sgimport_ctry<span class="sc">$</span>Countries, sgexport_ctry<span class="sc">$</span>Countries) <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enframe</span>(<span class="at">name =</span> <span class="cn">NULL</span>, <span class="at">value =</span> <span class="st">"diff"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(diff)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>import_vs_export  <span class="sc">|&gt;</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Countries in sgimport_cln that is not in sgexport_cln"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">row.names =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Countries in sgimport_cln that is not in sgexport_cln</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">diff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Anguilla</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Bahamas</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">Bermuda</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">Cocos (Keeling) Islands</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">Commonwealth Of Independent States</td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: left;">Cook Islands</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7</td>
<td style="text-align: left;">French Guiana</td>
</tr>
<tr class="even">
<td style="text-align: left;">8</td>
<td style="text-align: left;">French Southern Territories</td>
</tr>
<tr class="odd">
<td style="text-align: left;">9</td>
<td style="text-align: left;">Grenada</td>
</tr>
<tr class="even">
<td style="text-align: left;">10</td>
<td style="text-align: left;">Guatemala</td>
</tr>
<tr class="odd">
<td style="text-align: left;">11</td>
<td style="text-align: left;">Honduras</td>
</tr>
<tr class="even">
<td style="text-align: left;">12</td>
<td style="text-align: left;">Jamaica</td>
</tr>
<tr class="odd">
<td style="text-align: left;">13</td>
<td style="text-align: left;">Kiribati</td>
</tr>
<tr class="even">
<td style="text-align: left;">14</td>
<td style="text-align: left;">Liechtenstein</td>
</tr>
<tr class="odd">
<td style="text-align: left;">15</td>
<td style="text-align: left;">Micronesia</td>
</tr>
<tr class="even">
<td style="text-align: left;">16</td>
<td style="text-align: left;">Nauru</td>
</tr>
<tr class="odd">
<td style="text-align: left;">17</td>
<td style="text-align: left;">Netherlands Antilles</td>
</tr>
<tr class="even">
<td style="text-align: left;">18</td>
<td style="text-align: left;">Niue</td>
</tr>
<tr class="odd">
<td style="text-align: left;">19</td>
<td style="text-align: left;">Norfolk Island</td>
</tr>
<tr class="even">
<td style="text-align: left;">20</td>
<td style="text-align: left;">Norway</td>
</tr>
<tr class="odd">
<td style="text-align: left;">21</td>
<td style="text-align: left;">Other Countries In America</td>
</tr>
<tr class="even">
<td style="text-align: left;">22</td>
<td style="text-align: left;">Palau</td>
</tr>
<tr class="odd">
<td style="text-align: left;">23</td>
<td style="text-align: left;">Panama</td>
</tr>
<tr class="even">
<td style="text-align: left;">24</td>
<td style="text-align: left;">South Sudan</td>
</tr>
<tr class="odd">
<td style="text-align: left;">25</td>
<td style="text-align: left;">St Vincent &amp; The Grenadines</td>
</tr>
<tr class="even">
<td style="text-align: left;">26</td>
<td style="text-align: left;">Trinidad &amp; Tobago</td>
</tr>
<tr class="odd">
<td style="text-align: left;">27</td>
<td style="text-align: left;">Tuvalu</td>
</tr>
<tr class="even">
<td style="text-align: left;">28</td>
<td style="text-align: left;">Wallis &amp; Fatuna Islands</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Referring to above list, there are 28 countries with available import data, but has no export data.</p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>We cannot assume that the exports are zero, just because there is no available data.</p>
</div>
</div>
</section>
<section id="joining-the-two-tibbles-and-calculate-trade-balance-and-volume" class="level4">
<h4 class="anchored" data-anchor-id="joining-the-two-tibbles-and-calculate-trade-balance-and-volume">2.2.4 Joining the two tibbles and calculate trade balance and volume</h4>
<p><code>dplyr::left_join()</code> function is used to join <strong><em>sgimport_cln</em></strong> and <strong><em>sgexport_cln</em></strong>. This is especially useful to avoid since <strong><em>sgimport_cln</em></strong> has more rows than <strong><em>sgexport_cln</em></strong>.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>left_join()</code> <strong>takes all the values from the first tibble, and looks for matches in the second tibble</strong>. If it finds a match, it adds the data from the second table; if not, it adds missing values.</p>
</div>
</div>
<p>Countries with missing values in <strong>Export_SGD</strong> variable created by left_join() function will be excluded from analysis. As highlighted above, we cannot assume that the exports are zero, just because there is no available data. This is to avoid incomplete data when analysing trade balances. To remove this, <strong><em>import_vs_export</em></strong> tibble created above will be used to filter out the countries using <code>dplyr::filter()</code>.</p>
<p>Beside the countries in <strong><em>import_vs_export</em></strong>, it is noted that the import and export values of “Germany, Democratic Republic Of” are zeroes. This is referring to East Germany, a state that no longer exists since German reunification in 1990. This country is in the tibble as the original dataset tracks Singapore import/export data from 1976. Given the scope of the study from January 2020 onward, we will filter out this country as well using <code>dplyr::filter()</code>.</p>
<p>Note that “Other&nbsp;Countries&nbsp;In&nbsp;Oceania” is also removed as it is a collection of countries.</p>
<p>Additional data cleaning required :</p>
<ul>
<li><p>Shortening the names of some countries like “Germany, Federal Republic Of”, “Vietnam, Socialist Republic Of”, and “Republic Of Korea”. <code>dplyr::mutate()</code> is used in conjunction with <code>case_when()</code></p></li>
<li><p>Create new variable <strong>Trade_Balance_SGD</strong> subtracts <strong>Import_SGD</strong> from <strong>Export_SGD</strong> to indicate whether there is trade surplus or deficit from Singapore point-of-view</p></li>
<li><p>Create new variable <strong>Trade_Volume_SGD</strong> sums <strong>Export_SGD</strong> with <strong>Import_SGD</strong> as indication of total trade activities</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sgtrade_cln <span class="ot">&lt;-</span> sgimport_cln <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#join sgimport_cln with sgexport_cln</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sgexport_cln, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'Countries'</span> <span class="ot">=</span> <span class="st">'Countries'</span>, <span class="st">'Month_Year'</span> <span class="ot">=</span> <span class="st">'Month_Year'</span>, <span class="st">'Month'</span> <span class="ot">=</span> <span class="st">'Month'</span>, <span class="st">'Year'</span> <span class="ot">=</span> <span class="st">'Year'</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#remove countries with non-available export data</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>Countries <span class="sc">%in%</span> <span class="fu">c</span>(import_vs_export<span class="sc">$</span>diff, <span class="st">"Germany, Democratic Republic Of"</span>, <span class="st">"Other Countries In Oceania"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Countries =</span> <span class="fu">case_when</span>(Countries <span class="sc">==</span> <span class="st">"Germany, Federal Republic Of"</span> <span class="sc">~</span> <span class="st">"Germany"</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                               Countries <span class="sc">==</span> <span class="st">"Vietnam, Socialist Republic Of"</span> <span class="sc">~</span> <span class="st">"Vietnam"</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                               Countries <span class="sc">==</span> <span class="st">"Republic Of Korea"</span> <span class="sc">~</span> <span class="st">"South Korea"</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                               <span class="cn">TRUE</span> <span class="sc">~</span> Countries)) <span class="sc">|&gt;</span> </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Calculate trade balance</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Trade_Balance_SGD =</span> Export_SGD <span class="sc">-</span> Import_SGD,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">Trade_Volumes_SGD =</span> Export_SGD <span class="sc">+</span> Import_SGD) </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(sgtrade_cln))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 12%">
<col style="width: 11%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Month_Year</th>
<th style="text-align: left;">Countries</th>
<th style="text-align: right;">Year</th>
<th style="text-align: left;">Month</th>
<th style="text-align: right;">Import_SGD</th>
<th style="text-align: right;">Export_SGD</th>
<th style="text-align: right;">Trade_Balance_SGD</th>
<th style="text-align: right;">Trade_Volumes_SGD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2022-12-01</td>
<td style="text-align: left;">Belgium</td>
<td style="text-align: right;">2022</td>
<td style="text-align: left;">Dec</td>
<td style="text-align: right;">103655000</td>
<td style="text-align: right;">432376000</td>
<td style="text-align: right;">328721000</td>
<td style="text-align: right;">536031000</td>
</tr>
<tr class="even">
<td style="text-align: left;">2022-11-01</td>
<td style="text-align: left;">Belgium</td>
<td style="text-align: right;">2022</td>
<td style="text-align: left;">Nov</td>
<td style="text-align: right;">121773000</td>
<td style="text-align: right;">756814000</td>
<td style="text-align: right;">635041000</td>
<td style="text-align: right;">878587000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2022-10-01</td>
<td style="text-align: left;">Belgium</td>
<td style="text-align: right;">2022</td>
<td style="text-align: left;">Oct</td>
<td style="text-align: right;">88796000</td>
<td style="text-align: right;">350565000</td>
<td style="text-align: right;">261769000</td>
<td style="text-align: right;">439361000</td>
</tr>
<tr class="even">
<td style="text-align: left;">2022-09-01</td>
<td style="text-align: left;">Belgium</td>
<td style="text-align: right;">2022</td>
<td style="text-align: left;">Sep</td>
<td style="text-align: right;">215978000</td>
<td style="text-align: right;">386724000</td>
<td style="text-align: right;">170746000</td>
<td style="text-align: right;">602702000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2022-08-01</td>
<td style="text-align: left;">Belgium</td>
<td style="text-align: right;">2022</td>
<td style="text-align: left;">Aug</td>
<td style="text-align: right;">132917000</td>
<td style="text-align: right;">570824000</td>
<td style="text-align: right;">437907000</td>
<td style="text-align: right;">703741000</td>
</tr>
<tr class="even">
<td style="text-align: left;">2022-07-01</td>
<td style="text-align: left;">Belgium</td>
<td style="text-align: right;">2022</td>
<td style="text-align: left;">Jul</td>
<td style="text-align: right;">224676000</td>
<td style="text-align: right;">991586000</td>
<td style="text-align: right;">766910000</td>
<td style="text-align: right;">1216262000</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="finding-top-countries-by-trade-volume" class="level4">
<h4 class="anchored" data-anchor-id="finding-top-countries-by-trade-volume">2.2.5 Finding top countries by trade volume</h4>
<p>Not all countries trade equally with Singapore. Despite performing the extensive data cleaning in the previous sections, there are still 82 countries in the tibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(sgtrade_cln<span class="sc">$</span>Countries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 82</code></pre>
</div>
</div>
<p>In order to limit the scope of the study further, it is desired to calculate the each country trade volume and percentage of total trade volume. This will provide basis to filter out countries that contributed less than 0.05% of total trade volumes to Singapore.</p>
<p>The code chunk below performs:</p>
<ul>
<li><p>Group <strong><em>sgtrade_cln</em></strong> by <strong>Countries</strong> and calculate each country’s <strong>Total_Trade_Volumes_SGD</strong> using <code>dplyr::summarise()</code> function</p></li>
<li><p>Calculate <strong>Pct_Total_Trade_Volumes</strong> by dividing each country’s <strong>Total_Trade_Volumes_SGD</strong> with the sum(<strong>Total_Trade_Volumes_SGD</strong>) using <code>dplyr::mutate()</code> function</p></li>
<li><p>Arrange the countries by <strong>Pct_Total_Trade_Volumes</strong> in descending order and showcase the data</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>sgtrade_top_ctry <span class="ot">&lt;-</span> sgtrade_cln <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Group by Countries and calculated Total Trade Volumes of Singapore</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Countries) <span class="sc">|&gt;</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total_Trade_Volumes_SGD =</span> <span class="fu">sum</span>(Trade_Volumes_SGD)) <span class="sc">|&gt;</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Calculate the percentage of trade volume each country contributes to Singapore Total</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Pct_Total_Trade_Volumes =</span> <span class="fu">round</span>(Total_Trade_Volumes_SGD<span class="sc">*</span><span class="dv">100</span><span class="sc">/</span><span class="fu">sum</span>(Total_Trade_Volumes_SGD), <span class="at">digits =</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Arrange the countries based on the percentage</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Pct_Total_Trade_Volumes))</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(sgtrade_top_ctry))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">Countries</th>
<th style="text-align: right;">Total_Trade_Volumes_SGD</th>
<th style="text-align: right;">Pct_Total_Trade_Volumes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mainland China</td>
<td style="text-align: right;">475482628000</td>
<td style="text-align: right;">14.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Malaysia</td>
<td style="text-align: right;">385151258000</td>
<td style="text-align: right;">11.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">United States</td>
<td style="text-align: right;">340907625000</td>
<td style="text-align: right;">10.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Taiwan</td>
<td style="text-align: right;">289258502000</td>
<td style="text-align: right;">8.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hong Kong</td>
<td style="text-align: right;">237874786000</td>
<td style="text-align: right;">7.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Indonesia</td>
<td style="text-align: right;">184262941000</td>
<td style="text-align: right;">5.5</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Next, we will filter out countries that contribute less that 0.05% of Singapore total trade using dplyr::filter() function from <strong><em>sgtrade_cln</em></strong>.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The newly created variables : <strong>Total_Trade_Volumes_SGD</strong> and <strong>Pct_Total_Trade_Volumes</strong> might be useful for future plots, hence <code>dplyr::left_join()</code> function is again used.</p>
</div>
</div>
<p>By doing this, the number of countries are reduced to 52</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Filter out the Countries with Pct_Total_Trade_Volumes &lt; 0.05%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>top0<span class="fl">.05</span> <span class="ot">&lt;-</span> sgtrade_top_ctry <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Pct_Total_Trade_Volumes <span class="sc">&gt;</span> <span class="fl">0.05</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>sgtrade_cln <span class="ot">&lt;-</span> sgtrade_cln <span class="sc">|&gt;</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Countries <span class="sc">%in%</span> top0<span class="fl">.05</span><span class="sc">$</span>Countries) <span class="sc">|&gt;</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#include the Total_Trade_Volumes_SGD and Pct_Total_Trade_Volumes in sgtrade_cln</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(top0<span class="fl">.05</span>, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'Countries'</span> <span class="ot">=</span> <span class="st">'Countries'</span>))</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#finding out the number of distinct countries left</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(sgtrade_cln<span class="sc">$</span>Countries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 52</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="visualisation" class="level2">
<h2 class="anchored" data-anchor-id="visualisation"><strong>3. Visualisation</strong></h2>
<section id="exploratory-data-visualisation" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-data-visualisation">3.1 Exploratory Data Visualisation</h3>
<p>The plots in this section offer a high-level overview of Singapore’s bilateral merchandise trade performance amid Covid-19 recovery, with the aim of identifying general trends through exploratory analysis. Rather than providing detailed analyses for each country, the focus is on identifying broad patterns and relationships. This approach enables the identification of countries of interest, providing context for more focused analyses in the following section.</p>
<section id="sec-3.1.1" class="level4">
<h4 class="anchored" data-anchor-id="sec-3.1.1">3.1.1 Overall Singapore Trade Balance Performance</h4>
<p>To gain an understanding of import and export trends in Singapore, we will begin with a simple time-series chart covering the period from January 2020 to December 2022.</p>
<section id="sec-3.1.1.1" class="level5">
<h5 class="anchored" data-anchor-id="sec-3.1.1.1">3.1.1.1 Design Consideration</h5>
<p>Instead of using simple line charts, braided ribbon chart is used with the following considerations:</p>
<ul>
<li><p>Braided ribbon charts helps to visualise the areas between import and export values, highlighting Singapore trade balance</p></li>
<li><p>Reference line will be provided, representing the average import and export values in 2020, which was a year marked by worldwide lockdowns and reduced economic activity due to the Covid-19 pandemic. This time period has been chosen as a relevant benchmark for understanding the impact of the pandemic on import and export trends.</p></li>
<li><p>Annotations explaining the events around the world</p></li>
</ul>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some details in the plot can help to enhance the visual aesthetics, such as:</p>
<ul>
<li><p>Using diverging colorblind friendly palette</p></li>
<li><p>Display the values in Billions SGD rather than the raw values</p></li>
<li><p>Using arrows to aid annotations</p></li>
<li><p>Clear intent in title, highlighting the story</p></li>
<li><p>Label the lines instead of using legend</p></li>
</ul>
</div>
</div>
</section>
<section id="sec-3.1.1.2" class="level5">
<h5 class="anchored" data-anchor-id="sec-3.1.1.2">3.1.1.2 Preparation of visualisation</h5>
<section id="data-preparation-1" class="level6">
<h6 class="anchored" data-anchor-id="data-preparation-1"><u>Data preparation</u></h6>
<p>Three tibbles are created for the following purpose:</p>
<ul>
<li><p><strong><em>totalsgtrade</em></strong> contains the total import and export values by time, irrespective of countries.<br>
This is created by grouping <strong><em>sgtrade_cln</em></strong> data by <strong>Month_Year</strong> and <strong>Year</strong> variables and calculate the total Singapore Import and Export values, irrespective of countries. <code>dplyr::group_by()</code> and <code>dplyr::summarise()</code> functions are used.</p></li>
<li><p><strong><em>totalsgtrade_long</em></strong> collapses the <strong>Import</strong> and <strong>Export</strong> columns to new variable <strong>Type</strong>. This is used for geom_line to allow plotting different lines and grouped them by color. <code>tidyr::pivot_longer()</code> is used to do this.</p></li>
<li><p><strong><em>avg_total_2020</em></strong> creates 1x3 tibble containing the overall average 2020 Singapore import and export values to draw the reference lines. Firstly <strong><em>totalsgtrade</em></strong> is filtered for <code>Year == 2020</code>. It is then grouped and summarised by mean of <strong>Import</strong> and <strong>Export</strong>.</p></li>
</ul>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating new tibbles to be used for geom_line and geom_braid respectively</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>totalsgtrade <span class="ot">&lt;-</span> sgtrade_cln <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Month_Year, Year) <span class="sc">|&gt;</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Import =</span> <span class="fu">sum</span>(Import_SGD),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">Export =</span> <span class="fu">sum</span>(Export_SGD))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>totalsgtrade_long <span class="ot">&lt;-</span> totalsgtrade <span class="sc">|&gt;</span> </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">!</span><span class="fu">c</span>(Month_Year, Year),</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Type"</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Values"</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating new tibble to be used for reference line</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>avg_total_2020 <span class="ot">&lt;-</span> totalsgtrade <span class="sc">|&gt;</span> </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span> (Year) <span class="sc">|&gt;</span> </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">import =</span> <span class="fu">mean</span>(Import),</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">export =</span> <span class="fu">mean</span>(Export))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plotting-the-main-graph" class="level6">
<h6 class="anchored" data-anchor-id="plotting-the-main-graph"><u>Plotting the main graph</u></h6>
<p>Steps used to create the plots:</p>
<ul>
<li><p>Base plot is created using <code>ggplot2::geom_line</code> and <code>ggbraid::geom_braid</code></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that <strong><em>totalsgtrade_long</em></strong> is used in <code>geom_line</code> to allow grouping the <strong>Type</strong> (Import or Export) by color and <strong><em>totalsgtrade</em></strong> is used in <code>geom_braid</code>. The <code>fill</code> argument of <code>geom_braid</code> is specified as <code>Import&lt;Export</code> as Trade Surplus happens when Import &lt; Export, and <code>alpha</code> specified as 0.5 to provide a degree of opacity.</p>
</div>
</div></li>
<li><p>Remove the legend using <code>ggplot2::guides()</code> and add the labels at the end of each line using <code>directlabels:geom_dl()</code>. Note the <code>method</code> argument specifies gap between the label and the line</p></li>
<li><p>Plotting the reference line using <code>ggplot2::geom_hline</code>. The <code>linetype</code> argument is specified as <code>"dashed"</code> to create dashed reference line. Add text on each reference line to indicate “Average 2020” using <code>ggplot2::annotate()</code></p></li>
<li><p>Set the colors of the line and ribbons using <code>scale_color_manual()</code> and <code>scale_color_fill()</code></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The color choice for colorblind-friendly is based on this <a href="https://davidmathlogic.com/colorblind/#%23D81B60-%231E88E5-%23FFC107-%23004D40">article</a></p>
</div>
</div></li>
<li><p>As the x-axis is datetime, <code>scale_x_date()</code> needs to be used, indicating the <code>limits</code> of plots, <code>date_breaks</code>, and <code>date_labels</code> format. It is good to set the limit on the first time frame (January 2020) to remove gap on the left-hand side of the graph, hence <code>expand</code> argument is specified as c(0,0)</p></li>
<li><p>In order to convert the y-axis in terms of Billions SGD, we need to specify it in the <code>labels</code> argument of <code>scale_y_continuous</code></p></li>
<li><p>Set the theme and add titles, subtitles, and captions using <code>theme()</code> and <code>labs()</code> functions</p></li>
</ul>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the base plot</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>br_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> totalsgtrade_long,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> Month_Year,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> Values,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> Type,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> Type),</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_braid</span>(<span class="at">data =</span> totalsgtrade,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Month_Year,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ymin =</span> Import,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ymax =</span> Export,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> Import <span class="sc">&lt;</span> Export),</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Remove the legend </span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">linetype =</span> <span class="st">"none"</span>, <span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding the 'Import' and 'Export' labels at the end of the line charts</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dl</span>(<span class="at">data =</span> totalsgtrade_long,</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">x =</span> Month_Year,</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">y =</span> Values,</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">label =</span> Type,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> Type),</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">method =</span> <span class="fu">list</span>(<span class="fu">dl.trans</span>(<span class="at">x =</span> x <span class="sc">+</span> <span class="fl">0.2</span>), <span class="st">"last.points"</span>, <span class="at">cex =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dl</span>(<span class="at">data =</span> totalsgtrade_long,</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">x =</span> Month_Year,</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">y =</span> Values,</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">label =</span> Type,</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> Type),</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">method =</span> <span class="fu">list</span>(<span class="fu">dl.trans</span>(<span class="at">x =</span> x <span class="sc">-</span> <span class="fl">0.2</span>), <span class="st">"first.points"</span>, <span class="at">cex =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the reference lines with annotations</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> avg_total_2020<span class="sc">$</span>export), </span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>             <span class="at">col=</span><span class="st">"#0072B2"</span>, </span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth=</span><span class="fl">0.8</span>,</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>           <span class="at">x=</span><span class="fu">as.Date</span>(<span class="st">"2022-12-01"</span>), </span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>           <span class="at">y=</span><span class="dv">42000000000</span>, </span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">label=</span><span class="st">"Avg 2020 Export"</span>, </span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>           <span class="at">size=</span><span class="dv">4</span>, </span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">color=</span><span class="st">"#0072B2"</span>) <span class="sc">+</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> avg_total_2020<span class="sc">$</span>import), </span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>             <span class="at">col=</span><span class="st">"#D55E00"</span>, </span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth=</span><span class="fl">0.8</span>,</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>           <span class="at">x=</span><span class="fu">as.Date</span>(<span class="st">"2022-12-01"</span>), </span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>           <span class="at">y=</span><span class="dv">37500000000</span>, </span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>           <span class="at">label=</span><span class="st">"Avg 2020 Import"</span>, </span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>           <span class="at">size=</span><span class="dv">4</span>, </span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>           <span class="at">color=</span><span class="st">"#D55E00"</span>) <span class="sc">+</span></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting the colors for the main plot  </span></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>),</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Export"</span>, <span class="st">"Import"</span>),</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>)) <span class="sc">+</span></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a><span class="co">#Adjusting the scale</span></span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>               <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"2020-01-01"</span>),<span class="fu">as.Date</span>(<span class="st">"2023-03-01"</span>)),</span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>               <span class="at">date_breaks =</span> <span class="st">"6 month"</span>,</span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>               <span class="at">date_labels =</span> <span class="st">"%b %Y"</span>) <span class="sc">+</span></span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Trade Values"</span>,</span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="cf">function</span>(x){<span class="fu">paste0</span>(<span class="st">'$'</span>, <span class="fu">abs</span>(x<span class="sc">/</span><span class="dv">1000000000</span>),<span class="st">'B'</span>)}) <span class="sc">+</span></span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting the theme</span></span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a>  cowplot<span class="sc">::</span><span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">'top'</span>,</span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="st">'center'</span>,</span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey90"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>)) <span class="sc">+</span></span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding title, subtitle, and captions   </span></span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Since early 2021, Singapore's trade activities were recovering from Covid-19</span><span class="sc">\n</span><span class="st">but slowed down in mid-2022"</span>,</span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Total Merchandise Export and Import Trade Value of Singapore (in SGD), 2020-2022"</span>,</span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption =</span> <span class="st">"Merchandise Trade by Region/Market from Department of Statistics, Singapore"</span>)</span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a>br_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/Overall Singapore Trade Balance-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
</section>
<section id="sec-3.1.1.3" class="level5">
<h5 class="anchored" data-anchor-id="sec-3.1.1.3">3.1.1.3 Insights</h5>
<ul>
<li><p>Overall, Singapore maintains trade surplus throughout the duration, except for brief period in May 2022</p></li>
<li><p>In March 2020, both Singapore import and export fell further, coinciding with announcement of further Covid-19 restrictions (i.e., circuit breaker)</p></li>
<li><p>With gradual reopening of economy (i.e., Phase 3 reopening) in Dec 2020 to February 2021, trade seems to rebound back above the 2020 average. Throughout 2021, both import and export continues to rise</p></li>
<li><p>Sudden dip observed around February 2022, coinciding with the start of Russia-Ukraine War</p></li>
<li><p>Trade surplus seems to be thinning in 2022, but activities remain high, reaching its peak in August/September 2022</p></li>
<li><p>Gradual decline of trade happens after the 3-year peak marking recession headwinds post Q3 2022</p></li>
</ul>
<p>With interesting insights observed above, it makes sense to include them in the plot as well. Hence <code>annotate()</code> functions are used to add the text label and arrows. Refer to code below for more details.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Add relevant annotations   </span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>br_plot <span class="sc">+</span> <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"label"</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">"2020-02-01"</span>),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">45000000000</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Covid19 restriction kicks in</span><span class="sc">\n</span><span class="st"> in Singapore"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="st">"left"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"segment"</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">"2020-05-01"</span>), </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">44000000000</span>, </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">xend =</span> <span class="fu">as.Date</span>(<span class="st">"2020-03-15"</span>),  </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">yend =</span> <span class="dv">41500000000</span>,  </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"grey40"</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">"inches"</span>))</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">+</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"label"</span>,</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">"2020-07-01"</span>),</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">55000000000</span>,</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Trade rebounds</span><span class="sc">\n</span><span class="st">post-Covid19 relaxation"</span>,</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="st">"left"</span>,</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">+</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"segment"</span>,</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">"2020-10-01"</span>), </span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">54000000000</span>, </span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">xend =</span> <span class="fu">as.Date</span>(<span class="st">"2021-02-01"</span>),  </span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">yend =</span> <span class="dv">45000000000</span>,  </span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"grey40"</span>,</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>,</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>                         <span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">"inches"</span>))</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">+</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"label"</span>,</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-01"</span>),</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">38000000000</span>,</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Start of Russia-Ukraine War"</span>,</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="st">"left"</span>,</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">+</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"segment"</span>,</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">"2022-04-01"</span>), </span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">38500000000</span>, </span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>           <span class="at">xend =</span> <span class="fu">as.Date</span>(<span class="st">"2022-02-01"</span>),  </span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>           <span class="at">yend =</span> <span class="dv">43000000000</span>,  </span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"grey40"</span>,</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>,</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>                         <span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">"inches"</span>))</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">+</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"label"</span>,</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">"2021-08-01"</span>),</span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">58000000000</span>,</span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"3-Year High</span><span class="sc">\n</span><span class="st">Trade Activities"</span>,</span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="st">"left"</span>,</span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">+</span></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"segment"</span>,</span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">"2021-12-25"</span>), </span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">58000000000</span>, </span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>           <span class="at">xend =</span> <span class="fu">as.Date</span>(<span class="st">"2022-06-01"</span>),  </span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>           <span class="at">yend =</span> <span class="dv">60000000000</span>,  </span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"grey40"</span>,</span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>,</span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>                         <span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">"inches"</span>))</span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">+</span></span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"label"</span>,</span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">"2022-05-01"</span>),</span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">45000000000</span>,</span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Recession headwinds</span><span class="sc">\n</span><span class="st">results in trade slumps"</span>,</span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="st">"left"</span>,</span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">+</span></span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"segment"</span>,</span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">as.Date</span>(<span class="st">"2022-09-01"</span>), </span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="dv">46000000000</span>, </span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>           <span class="at">xend =</span> <span class="fu">as.Date</span>(<span class="st">"2022-08-01"</span>),  </span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a>           <span class="at">yend =</span> <span class="dv">56000000000</span>,  </span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"grey40"</span>,</span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>,</span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a>                         <span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">"inches"</span>))</span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a>           ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/Overall Singapore Trade Balance Annotations-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
</section>
<section id="overview-of-singapore-trade-balance-by-countries" class="level4">
<h4 class="anchored" data-anchor-id="overview-of-singapore-trade-balance-by-countries">3.1.2 Overview of Singapore Trade Balance by Countries</h4>
<p>After data wrangling, the main tibble <strong><em>sgtrade_cln</em></strong> still contains data for 52 countries, making it challenging to identify which ones show interesting trends. A horizon graph provides a solution by allowing for the visualization of massive time-series data, providing an overview of the Singapore trade balance for all countries. This is a better alternative than using a trellis line graph which requires the same scale for all countries and may skew user perspective.</p>
<p><code>ggHoriPlot::geom_horizon()</code> is used to create the horizon graph.</p>
<section id="design-consideration" class="level5">
<h5 class="anchored" data-anchor-id="design-consideration">3.1.2.1 Design Consideration</h5>
<p>The dataset poses a challenge due to the large disparity in trading volume between the largest (Mainland China) and smallest (Cyprus) trading partners. Such imbalanced data can draw focus away from smaller partners, which may offer valuable insights. To strike a balance between the scale of importance (i.e., volume) and patterns, we need to be mindful of these differences. Considerations:</p>
<ul>
<li><p>There are two options to reduce data imbalance to be considered in this plot :</p>
<ul>
<li><p>Plotting by normalised trade balance</p></li>
<li><p>Plotting by rate of change of trade balance</p></li>
</ul></li>
<li><p>Remove outliers when setting the cutpoints to avoid distorting the horizon graph</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Setting the right cutpoints for horizon graph is important. Hence careful considerations need to be taken with outliers. As such, cutpoints should be set on outlier-free data. This can be done by removing values below the 0.25 quantile - 1.5 times the interquartile range and above the 0.75 quantile + 1.5 times the interquartile range.</p>
<p>Refer to this <a href="https://rivasiker.github.io/ggHoriPlot/articles/ggHoriPlot.html">article</a> for more details on handling outliers from horizon graph</p>
</div>
</div></li>
<li><p>Legends should be removed as the intent of the graph is to detect patterns, hence absolute values are not critical</p></li>
<li><p>Other improvements to enhance visual aesthetics like - having clear title, choosing diverging colorblind-friendly pallete</p></li>
</ul>
</section>
<section id="preparation-of-visualisation" class="level5">
<h5 class="anchored" data-anchor-id="preparation-of-visualisation">3.1.2.2 Preparation of visualisation</h5>
<section id="creating-normalisation-function" class="level6">
<h6 class="anchored" data-anchor-id="creating-normalisation-function"><u>Creating normalisation function</u></h6>
<p>Min-max normalisation is used to convert the data to 0 to 1 scale by applying the following formula</p>
<p><span class="math display">\[
(m - min(m)) / (max(m)-min(m))
\]</span></p>
<p>As such, simple function called <code>normalit</code> can be created below</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating the normalising function</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>normalit<span class="ot">&lt;-</span><span class="cf">function</span>(m){</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>   (m <span class="sc">-</span> <span class="fu">min</span>(m))<span class="sc">/</span>(<span class="fu">max</span>(m)<span class="sc">-</span><span class="fu">min</span>(m))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a> }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-preparation-2" class="level6">
<h6 class="anchored" data-anchor-id="data-preparation-2"><u>Data preparation</u></h6>
<p>A new tibble called <strong><em>sgtrade_cln_hor</em></strong> is created with two new variables:</p>
<ul>
<li><p><strong>Normalised_Trade_Balance</strong> is created by applying <code>normalit</code> function to <strong>Trade_Balance_SGD</strong></p></li>
<li><p><strong>Pct_Trade_Balance_Change</strong> represents the rate of change (%), is created by calculating the difference between adjacent time-series data for each country. <code>arrange()</code> function is first used to order the tibble based on <strong>Countries</strong> and <strong>Month_Year</strong>. The tibble is then grouped by <strong>Countries</strong> before the new variable is calculated using <code>mutate()</code></p></li>
</ul>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>sgtrade_cln_hor <span class="ot">&lt;-</span> sgtrade_cln <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Calculating the normalised trade balance</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Normalised_Trade_Balance =</span> <span class="fu">normalit</span>(Trade_Balance_SGD)) <span class="sc">|&gt;</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Calculating the Rate of Change</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Countries, Month_Year) <span class="sc">|&gt;</span> </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Countries) <span class="sc">|&gt;</span> </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Pct_Trade_Balance_Change =</span> <span class="fu">round</span>((Trade_Balance_SGD <span class="sc">-</span> <span class="fu">lag</span>(Trade_Balance_SGD))<span class="sc">*</span><span class="dv">100</span><span class="sc">/</span><span class="fu">lag</span>(Trade_Balance_SGD), <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="setting-the-cutpoints" class="level6">
<h6 class="anchored" data-anchor-id="setting-the-cutpoints"><u>Setting the cutpoints</u></h6>
<p><code>ggHoriPlot::geom_horizon()</code> requires two important arguments: <code>origin</code> and <code>horizonscale</code>.</p>
<p>The code chunks below remove the outliers (defined above) from the <strong><em>sgtrade_cln_hor</em></strong> and store them in new tibble <strong><em>cutpoints</em></strong> or <strong><em>curpoints_roc</em></strong> for normalised plot and rate of change plot respectively.</p>
<p>Origin point (<strong><em>ori</em></strong> and <strong><em>ori_roc</em></strong>) is defined as :</p>
<ul>
<li><p>For normalised plot, it is defined when absolute trade balance is zero</p></li>
<li><p>For rate of change plot, it is defined when the rate of change of trade balance is zero</p></li>
</ul>
<p>The scales (<strong><em>sca</em></strong> and <strong><em>sca_roc</em></strong>) are then defined by dividing range of variables to 8 segments. This is done by using <code>seq()</code> function, specifying <code>length.out</code> argument to be 9; removing the 5th element (<code>[-5]</code>) (to be replaced by origin point).</p>
<p>Refer to code chunk below for normalised plot</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Removing the outliers from cutpoints</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>cutpoints <span class="ot">&lt;-</span> sgtrade_cln_hor  <span class="sc">|&gt;</span>  </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">outlier =</span> <span class="fu">between</span>(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>      Normalised_Trade_Balance, </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(Normalised_Trade_Balance, <span class="fl">0.25</span>, <span class="at">na.rm=</span>T)<span class="sc">-</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.5</span><span class="sc">*</span><span class="fu">IQR</span>(Normalised_Trade_Balance, <span class="at">na.rm=</span>T),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(Normalised_Trade_Balance, <span class="fl">0.75</span>, <span class="at">na.rm=</span>T)<span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.5</span><span class="sc">*</span><span class="fu">IQR</span>(Normalised_Trade_Balance, <span class="at">na.rm=</span>T))) <span class="sc">%&gt;%</span> </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(outlier)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculating origin point - when trade balance is 0</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> (<span class="dv">0</span> <span class="sc">-</span> <span class="fu">min</span>(sgtrade_cln_hor<span class="sc">$</span>Trade_Balance_SGD))<span class="sc">/</span>(<span class="fu">max</span>(sgtrade_cln_hor<span class="sc">$</span>Trade_Balance_SGD)<span class="sc">-</span><span class="fu">min</span>(sgtrade_cln_hor<span class="sc">$</span>Trade_Balance_SGD))</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting the scales for horizon graph</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>sca <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">range</span>(cutpoints<span class="sc">$</span>Normalised_Trade_Balance)[<span class="dv">1</span>], </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>           <span class="fu">range</span>(cutpoints<span class="sc">$</span>Normalised_Trade_Balance)[<span class="dv">2</span>], </span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">length.out =</span> <span class="dv">9</span>)[<span class="sc">-</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Refer to code chunk below for rate of change plot</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Removing the outliers from cutpoints</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>cutpoints_roc <span class="ot">&lt;-</span> sgtrade_cln_hor  <span class="sc">|&gt;</span>  </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">outlier =</span> <span class="fu">between</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>      Pct_Trade_Balance_Change, </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(Pct_Trade_Balance_Change, <span class="fl">0.25</span>, <span class="at">na.rm=</span>T)<span class="sc">-</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.5</span><span class="sc">*</span><span class="fu">IQR</span>(Pct_Trade_Balance_Change, <span class="at">na.rm=</span>T),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(Pct_Trade_Balance_Change, <span class="fl">0.75</span>, <span class="at">na.rm=</span>T)<span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.5</span><span class="sc">*</span><span class="fu">IQR</span>(Pct_Trade_Balance_Change, <span class="at">na.rm=</span>T))) <span class="sc">%&gt;%</span> </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(outlier)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculating origin point </span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>ori_roc <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting the scales for horizon graph</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>sca_roc <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">range</span>(cutpoints_roc<span class="sc">$</span>Pct_Trade_Balance_Change, <span class="at">na.rm=</span>T)[<span class="dv">1</span>], </span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>           <span class="fu">range</span>(cutpoints_roc<span class="sc">$</span>Pct_Trade_Balance_Change, <span class="at">na.rm=</span>T)[<span class="dv">2</span>], </span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">length.out =</span> <span class="dv">9</span>)[<span class="sc">-</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plotting-the-main-graph-1" class="level6">
<h6 class="anchored" data-anchor-id="plotting-the-main-graph-1"><u>Plotting the main graph</u></h6>
<p>Steps used to create the two plots:</p>
<ul>
<li><p>Convert the <strong>Countries</strong> variable to factor, ordered by trade volumes in descending order using <code>forcats::fct_reorder()</code></p></li>
<li><p>Base plot is created using <code>ggHoriPlot::geom_horizon()</code>, specifying the <code>origin</code> and <code>horizonscale</code> arguments as defined above. The <code>show.legend</code> is also specified as <code>FALSE</code></p></li>
<li><p>Setting the colorblind-friendly diverging palette using <code>scale_fill_hcl()</code></p></li>
<li><p>Facet the plots by rows using <code>facet_grid()</code></p></li>
<li><p>As the x-axis is datetime, <code>scale_x_date()</code> needs to be used, indicating the <code>date_breaks</code> and <code>date_labels</code> format.</p></li>
<li><p>Set the theme and add titles, subtitles, and captions using <code>theme()</code> and <code>labs()</code> functions</p></li>
</ul>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Normalised Trade Balance</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Rate of Change of Trade Balance</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Converting countries to factor, ordered by trade volumes in descending order</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>sgtrade_cln_hor<span class="sc">$</span>Countries <span class="ot">&lt;-</span> <span class="fu">fct_reorder</span>(sgtrade_cln_hor<span class="sc">$</span>Countries, sgtrade_cln_hor<span class="sc">$</span>Total_Trade_Volumes_SGD, <span class="at">.desc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the base plot</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>sgtrade_cln_hor <span class="sc">|&gt;</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_horizon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Month_Year,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> Normalised_Trade_Balance,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="fu">after_stat</span>(Cutpoints)),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">origin =</span> ori, <span class="at">horizonscale =</span> sca,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting the color palette</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hcl</span>(<span class="at">palette =</span> <span class="st">'RdBu'</span>) <span class="sc">+</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co">#faceted based on Countries</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Countries<span class="sc">~</span>.) <span class="sc">+</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Adjusting the scale</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), </span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">date_breaks =</span> <span class="st">"6 month"</span>,</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">date_labels =</span> <span class="st">"%b</span><span class="sc">\n</span><span class="st">%Y"</span>) <span class="sc">+</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting the theme</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_few</span>() <span class="sc">+</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing.y=</span><span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"lines"</span>),</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding title, subtitle, and captions   </span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Singapore's trade surplus is decreasing against major partners post Covid-19 recovery, except with</span><span class="sc">\n</span><span class="st">Hong Kong, Indonesia and Thailand"</span>,</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Singapore's trade balance against trading partners arranged by trade volumes, 2020 to 2022"</span>,</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption =</span> <span class="st">"Merchandise Trade by Region/Market from Department of Statistics, Singapore"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/Horizon Plot Trade Balance-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Converting countries to factor, ordered by trade volumes in descending order</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>sgtrade_cln_hor<span class="sc">$</span>Countries <span class="ot">&lt;-</span> <span class="fu">fct_reorder</span>(sgtrade_cln_hor<span class="sc">$</span>Countries, sgtrade_cln_hor<span class="sc">$</span>Total_Trade_Volumes_SGD, <span class="at">.desc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the base plot</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>sgtrade_cln_hor <span class="sc">|&gt;</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_horizon</span>(<span class="fu">aes</span>(<span class="at">x =</span> Month_Year,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> Pct_Trade_Balance_Change,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="fu">after_stat</span>(Cutpoints)),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">origin =</span> ori_roc, <span class="at">horizonscale =</span> sca_roc,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting the color palette</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hcl</span>(<span class="at">palette =</span> <span class="st">'RdBu'</span>) <span class="sc">+</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co">#faceted based on Countries</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Countries<span class="sc">~</span>.) <span class="sc">+</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Adjusting the scale</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), </span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">date_breaks =</span> <span class="st">"6 month"</span>,</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">date_labels =</span> <span class="st">"%b</span><span class="sc">\n</span><span class="st">%Y"</span>) <span class="sc">+</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting the theme</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_few</span>() <span class="sc">+</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing.y=</span><span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"lines"</span>),</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding title, subtitle, and captions   </span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Volatile changes in Singapore's trade balance against major partners, except with</span><span class="sc">\n</span><span class="st">Taiwan, Hong Kong, and Indonesia"</span>,</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Singapore's trade balance change (MoM%) against trading partners arranged by trade volumes, 2020 to 2022"</span>,</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption =</span> <span class="st">"Merchandise Trade by Region/Market from Department of Statistics, Singapore"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/Horizon Plot Trade Balance Change-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="insights" class="level5">
<h5 class="anchored" data-anchor-id="insights">3.1.2.3 Insights</h5>
<section id="normalised-trade-balance-plot" class="level6">
<h6 class="anchored" data-anchor-id="normalised-trade-balance-plot"><u>Normalised Trade Balance Plot</u></h6>
<ul>
<li>Despite normalization, smaller partners can still be overshadowed by larger ones. To balance the scale of importance and patterns, the plot can guide the filtering out of certain trading partners. Based on the graph, we should not consider trading partners with lower trading volumes than Sri Lanka.</li>
</ul>
</section>
<section id="rate-of-change-of-trade-balance-plot" class="level6">
<h6 class="anchored" data-anchor-id="rate-of-change-of-trade-balance-plot"><u>Rate of Change of Trade Balance Plot</u></h6>
<ul>
<li>This plot provides a more balanced visualization between smaller and larger trading partners. However, it’s important to note that smaller trading partners exhibit higher intensity, which is expected as small changes in trading balance are overexaggerated due to their smaller volume</li>
</ul>
</section>
</section>
<section id="sec-3.1.2.4" class="level5">
<h5 class="anchored" data-anchor-id="sec-3.1.2.4">3.1.2.4 Selecting Countries for further analysis</h5>
<p>Singapore’s trading partners are diverse and can be broadly categorized into Major Partners, Other Regional Partners, European Partners, and Other Minor Partners. For this analysis, 16 countries were selected around the categories based on the following interesting observations:</p>
<table class="table">
<caption>Table 1: List of Selected Countries</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 33%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th>Category</th>
<th>Country</th>
<th>Normalised Plot</th>
<th>Rate of Change Plot</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Major Partners</td>
<td><p>Mainland China</p>
<p>(Largest partner)</p></td>
<td>Prominent swing from surplus to deficit in Q2 2022</td>
<td>High volatility before mid-2021 and after 2022</td>
</tr>
<tr class="even">
<td>Major Partners</td>
<td><p>Malaysia</p>
<p>(Largest ASEAN partner)</p></td>
<td>Constant trade deficit but starts to reduce in Q2 2022</td>
<td>Similar observation</td>
</tr>
<tr class="odd">
<td>Major Partners</td>
<td><p>United States</p>
<p>(Largest Western partner)</p></td>
<td>Swing from surplus to deficit from Q2 2021</td>
<td>High volatility throughout with dominant negative rate of change in Q2 2021 and 2022</td>
</tr>
<tr class="even">
<td>Major Partners</td>
<td>South Korea</td>
<td>Large trade deficit starts in Q3 2021</td>
<td>Prominent negative change preceding the deficit in Q2 2021</td>
</tr>
<tr class="odd">
<td>Other Regional Partners</td>
<td>Australia</td>
<td>Strong trade surplus recovery from Q2 2021</td>
<td>Strongly turns positive preceding the trade surplus few months before</td>
</tr>
<tr class="even">
<td>Other Regional Partners</td>
<td>India</td>
<td>Two major dips in early 2020 and mid 2021</td>
<td>Stronger trade balance recovery post 2020 dip vs 2021</td>
</tr>
<tr class="odd">
<td>Other Regional Partners</td>
<td>Philippines</td>
<td>Prominent trade surplus from Q3 2022</td>
<td>High volatility prior to Q3 2022</td>
</tr>
<tr class="even">
<td>Other Regional Partners</td>
<td>Cambodia</td>
<td>Large three export gains in Q1, Q3 2021, and Q2 2022</td>
<td>Similar observation with negative change prior to that</td>
</tr>
<tr class="odd">
<td>European Partners</td>
<td><p>Germany</p>
<p>(Largest European partner)</p></td>
<td>Reducing trade deficit from Q3 2022</td>
<td>Same observation with prominent single positive change in Q2 2021</td>
</tr>
<tr class="even">
<td>European Partners</td>
<td>France</td>
<td>Turns dominant deficit since Q1 2021</td>
<td>…but preceded by largely positive change</td>
</tr>
<tr class="odd">
<td>European Partners</td>
<td>Switzerland</td>
<td>Turns dominant deficit since Q2 2021</td>
<td>…but there are spikes of positive change, indicating volatility in trade balance</td>
</tr>
<tr class="even">
<td>European Partners</td>
<td>United Kingdom</td>
<td>Slight trade surplus in Q2 2020 aside from deficit in other period</td>
<td>…followed by dominant negative change</td>
</tr>
<tr class="odd">
<td>Other Minor Partners</td>
<td>Mexico</td>
<td>Maintaining very close trade balance</td>
<td>… but marked by high volatility post Q2 2021</td>
</tr>
<tr class="even">
<td>Other Minor Partners</td>
<td>New Zealand</td>
<td>Prominent trade surplus since Q2 2022</td>
<td>Same observation</td>
</tr>
<tr class="odd">
<td>Other Minor Partners</td>
<td>Canada</td>
<td>Small deficit peak in Q3 2022</td>
<td>Same observation in Q3 2022 with opposite impact in Q3 2020</td>
</tr>
<tr class="even">
<td>Other Minor Partners</td>
<td>Brunei Darussalam</td>
<td>Turns slight negative post Q2 2021 with small deficit peak in Q2 2022</td>
<td>High volatility from end 2020 to mid 2021</td>
</tr>
</tbody>
</table>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Other countries are not selected because of two possible conditions : 1) their trade volumes are too small (i.e., Bahrain) or 2) there is no interesting patterns (i.e., Indonesia).</p>
</div>
</div>
<section id="section-1" class="level6">
<h6 class="anchored" data-anchor-id="section-1"></h6>
</section>
</section>
</section>
</section>
<section id="bi-lateral-trade-of-singapore-against-selected-partners" class="level3">
<h3 class="anchored" data-anchor-id="bi-lateral-trade-of-singapore-against-selected-partners">3.2 Bi-lateral Trade of Singapore against selected partners</h3>
<p>In the previous section, 16 Singapore’s trading partners have been identified to be further examined. This section aims to dissect the general overview further to see whether the patterns identified above can be explained by individual country.</p>
<section id="singapore-trade-performance-on-monthly-basis" class="level4">
<h4 class="anchored" data-anchor-id="singapore-trade-performance-on-monthly-basis">3.2.1 Singapore Trade Performance on Monthly basis</h4>
<p>Having a line plot depicting Singapore trade activities are useful, but it might not be obvious enough to spot patterns at the monthly level. As such, calendar heatmap will be used.</p>
<section id="design-consideration-1" class="level5">
<h5 class="anchored" data-anchor-id="design-consideration-1">3.2.2.1 Design Consideration</h5>
<ul>
<li><p>Three heatmaps will be generated: two for the entire Singapore’s trade volume and trade balance and one depicting trade balance faceted by each country (16 countries). It does not make sense to depict trade volume by country as the major partners will dominate the map.</p></li>
<li><p>Grid design with months in x-axis and year in y-axis. They have to be ordered with the earliest year (2020) being on top</p></li>
<li><p>No text will be displayed as the calendar map is to show pattern instead of showing absolute values</p></li>
<li><p>For Plot 2 and 3: As Singapore overall trade balance is mostly positive, a imbalanced color scale needs to be used to ensure the neutral color remains at zero.</p></li>
</ul>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some details in the plot can help to enhance the visual aesthetics, such as:</p>
<ul>
<li><p>Using colorblind friendly palette - sequential for Plot1 and diverging for Plo2 and 3</p></li>
<li><p>Display the values in Billions SGD rather than the raw values</p></li>
<li><p>Clear intent in title, highlighting the story with colored text for highlight</p></li>
</ul>
</div>
</div>
</section>
<section id="preparation-of-visualisation-1" class="level5">
<h5 class="anchored" data-anchor-id="preparation-of-visualisation-1">3.2.2.2 Preparation of visualisation</h5>
<section id="data-preparation-3" class="level6">
<h6 class="anchored" data-anchor-id="data-preparation-3"><u>Data preparation</u></h6>
<p>Two tibbles are created for the following purpose:</p>
<ul>
<li><strong><em>totalsgtrade_calmap</em></strong> will be used to plot the first map displaying the entire Singapore trade balance. Hence, we can utilise <strong><em>totalsgtrade</em></strong> (refer to <a href="#sec-3.1.1.2">Section&nbsp;3.1.1.2</a> ) which already contains the total Singapore import and export values, irrespective of countries. However, the <strong>Month</strong>, <strong>Trade_Balance</strong>, and <strong>Trade Volumes</strong> variables need to be regenerated</li>
<li><strong><em>sgtrade_calmap</em></strong> will be used to plot the second map which is faceted by selected countries. The countries will need to be ordered based on total trade volumes using <code>forcats::fct_reorder()</code></li>
<li>Create variable called <strong><em>selected_countries</em></strong> to contain string of the 16 countries</li>
</ul>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is important to divide the newly calculated Trade Balance by 1B to display the values in Billions SGD</p>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating new tibbles to be used for geom_tile</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>totalsgtrade_calmap <span class="ot">&lt;-</span> totalsgtrade <span class="sc">|&gt;</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">factor</span>(<span class="fu">format</span>(Month_Year,<span class="st">"%b"</span>)), <span class="at">.after =</span> Year) <span class="sc">|&gt;</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Trade_Balance =</span> (Export <span class="sc">-</span> Import)<span class="sc">/</span><span class="dv">1000000000</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Trade_Volumes =</span> (Export <span class="sc">+</span> Import)<span class="sc">/</span><span class="dv">1000000000</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>sgtrade_calmap <span class="ot">&lt;-</span> sgtrade_cln <span class="sc">|&gt;</span> </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Trade_Balance =</span> Trade_Balance_SGD<span class="sc">/</span><span class="dv">1000000000</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Converting countries to factor, ordered by trade volumes in descending order</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>sgtrade_calmap<span class="sc">$</span>Countries <span class="ot">&lt;-</span> <span class="fu">fct_reorder</span>(sgtrade_calmap<span class="sc">$</span>Countries, sgtrade_calmap<span class="sc">$</span>Total_Trade_Volumes_SGD, <span class="at">.desc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Select the chosen 16 countries</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>selected_countries <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Mainland China"</span>, <span class="st">"Malaysia"</span>, <span class="st">"United States"</span>, <span class="st">"South Korea"</span>, <span class="st">"Australia"</span>, <span class="st">"India"</span>, <span class="st">"Philippines"</span>, <span class="st">"Cambodia"</span>, <span class="st">"Germany"</span>, <span class="st">"France"</span>, <span class="st">"Switzerland"</span>, <span class="st">"United Kingdom"</span>, <span class="st">"Mexico"</span>, <span class="st">"New Zealand"</span>, <span class="st">"Canada"</span>, <span class="st">"Brunei Darussalam"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plotting-the-main-graph-2" class="level6">
<h6 class="anchored" data-anchor-id="plotting-the-main-graph-2"><u>Plotting the main graph</u></h6>
<p>Steps used to create the two plots:</p>
<ul>
<li><p>Base plot is created using <code>ggplot2::geom_tile()</code>, specifying the <code>fill</code> argument by <strong>Trade_Volumes</strong> (Plot 1) or <strong>Trade_Balance</strong> (Plot 2 and 3) and <code>color</code> (tile border) argument as white. For the second plot, the data is further filtered by <strong><em>selected_countries</em></strong></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong>Year</strong> variable is converted to factor to be manually ordered to ensure that it appears in ascending order from the top to bottom</p>
</div>
</div></li>
<li><p>For Plot1: <code>scale_fill_gradient()</code> is used to specify high and low within sequential color scheme.</p></li>
<li><p>For Plot2 and 3: Setting imbalanced color scale using <code>scale_fill_gradientn()</code>, specifying that midpoint is 0. The color chosen is colorblind-friendly diverging palette</p></li>
<li><p><code>coord_equal()</code> is used to ensure equal scales for both x and y coordinates. This will create square grids</p></li>
<li><p>Only for second plot : Facet the plots in two columns using <code>facet_wrap()</code></p></li>
<li><p>Set the theme and add titles, subtitles, and captions using <code>theme()</code> and <code>labs()</code> functions. Note that <code>axis.ticks</code> argument is specified as <code>element_blank()</code> to remove them.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>theme_tufte()</code> is chosen as it does not have axis lines and grids, avoiding further requirement to specify them in <code>theme()</code></p>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>element_markdown()</code> argument is set in <code>theme()</code> for the second plot to enable markdown text to be specified in the <code>labs(title)</code>. This will allow specific color to be set on certain word.</p>
</div>
</div></li>
</ul>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Overall Singapore Trade Volume</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Overall Singapore Trade Balance</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Selected Countries</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the base plot</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(totalsgtrade_calmap <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">factor</span>(Year, <span class="at">levels =</span><span class="fu">c</span>(<span class="dv">2022</span>,<span class="dv">2021</span>,<span class="dv">2020</span>))), </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Month, </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Year, </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> Trade_Volumes)) <span class="sc">+</span> </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting the colors for the main plot</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">name =</span> <span class="st">"Trade Volume (Billions SGD)"</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">low =</span> <span class="st">"#D0E6F3"</span>, </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">high =</span> <span class="st">"#0072B2"</span>) <span class="sc">+</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Ensure equal scales for both coordinates  </span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting the theme to remove the x and y axis</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte</span>(<span class="at">base_family =</span> <span class="st">"Helvetica"</span>) <span class="sc">+</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)) <span class="sc">+</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding title, subtitle, and captions</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, </span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="cn">NULL</span>, </span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Singapore's trade volume rebounds amid Covid recovery from March 2021, peaking in July 2022;</span><span class="sc">\n</span><span class="st">slight slowdown observed from Oct 2022"</span>,</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">subtitle =</span> <span class="st">"Singapore Trade Volume by calendar months, 2020-2022"</span>,</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>     <span class="at">caption =</span> <span class="st">"Merchandise Trade by Region/Market from Department of Statistics, Singapore"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/Calendar Heatmap Volume Total-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the base plot</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(totalsgtrade_calmap <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">factor</span>(Year, <span class="at">levels =</span><span class="fu">c</span>(<span class="dv">2022</span>,<span class="dv">2021</span>,<span class="dv">2020</span>))), </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Month, </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Year, </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> Trade_Balance)) <span class="sc">+</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting the colors for the main plot</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">name =</span> <span class="st">"Trade Balance (Billions SGD)"</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">colors=</span><span class="fu">c</span>(<span class="st">"#D55E00"</span>,<span class="st">"grey90"</span>,<span class="st">"#0072B2"</span>),</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values=</span><span class="fu">rescale</span>(<span class="fu">c</span>(<span class="fu">min</span>(totalsgtrade_calmap<span class="sc">$</span>Trade_Balance),<span class="dv">0</span>,<span class="fu">max</span>(totalsgtrade_calmap<span class="sc">$</span>Trade_Balance))),</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits=</span><span class="fu">c</span>(<span class="fu">min</span>(totalsgtrade_calmap<span class="sc">$</span>Trade_Balance),<span class="fu">max</span>(totalsgtrade_calmap<span class="sc">$</span>Trade_Balance))) <span class="sc">+</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Ensure equal scales for both coordinates  </span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting the theme to remove the x and y axis</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte</span>(<span class="at">base_family =</span> <span class="st">"Helvetica"</span>) <span class="sc">+</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)) <span class="sc">+</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding title, subtitle, and captions</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, </span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="cn">NULL</span>, </span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Singapore's trade surplus declines in 2022; turning slightly negative in May 2022"</span>,</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>     <span class="at">subtitle =</span> <span class="st">"Singapore Trade Balance by calendar months, 2020-2022"</span>,</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>     <span class="at">caption =</span> <span class="st">"Merchandise Trade by Region/Market from Department of Statistics, Singapore"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/Calendar Heatmap Balance Total-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the base plot</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sgtrade_calmap <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">factor</span>(Year, <span class="at">levels =</span><span class="fu">c</span>(<span class="dv">2022</span>,<span class="dv">2021</span>,<span class="dv">2020</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(Countries <span class="sc">%in%</span> selected_countries), </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Month, </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Year, </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> Trade_Balance)) <span class="sc">+</span> </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span> </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting the colors for the main plot</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">name =</span> <span class="st">"Trade Balance (Billions SGD)"</span>,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">colors=</span><span class="fu">c</span>(<span class="st">"#D55E00"</span>,<span class="st">"grey90"</span>,<span class="st">"#0072B2"</span>),</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values=</span><span class="fu">rescale</span>(<span class="fu">c</span>(<span class="fu">min</span>(sgtrade_calmap<span class="sc">$</span>Trade_Balance),<span class="dv">0</span>,<span class="fu">max</span>(sgtrade_calmap<span class="sc">$</span>Trade_Balance))),</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits=</span><span class="fu">c</span>(<span class="fu">min</span>(sgtrade_calmap<span class="sc">$</span>Trade_Balance),<span class="fu">max</span>(sgtrade_calmap<span class="sc">$</span>Trade_Balance)),</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="fu">guide_colorbar</span>(<span class="at">barheight =</span> <span class="fu">unit</span>(<span class="dv">105</span>, <span class="at">units =</span> <span class="st">"mm"</span>))) <span class="sc">+</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Ensure equal scales for both coordinates </span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co">#faceted based on Countries</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Countries, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting the theme to remove the x and y axis</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte</span>(<span class="at">base_family =</span> <span class="st">"Helvetica"</span>) <span class="sc">+</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_markdown</span>(<span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/Calendar Heatmap by Countries-1.png" class="img-fluid" width="960"></p>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding title, subtitle, and captions</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="cn">NULL</span>, </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Singapore's trade balance post Covid recovery: Turns &lt;span style = 'color:#D55E00'&gt;Negative&lt;/span&gt; with China, USA, and South Korea;&lt;br&gt;&lt;span style = 'color:#0072B2'&gt;Positive&lt;/span&gt; with Cambodia"</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">subtitle =</span> <span class="st">"Singapore Trade Balance against selected partners by calendar months, 2020-2022"</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">caption =</span> <span class="st">"Merchandise Trade by Region/Market from Department of Statistics, Singapore"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$x
NULL

$y
NULL

$title
[1] "Singapore's trade balance post Covid recovery: Turns &lt;span style = 'color:#D55E00'&gt;Negative&lt;/span&gt; with China, USA, and South Korea;&lt;br&gt;&lt;span style = 'color:#0072B2'&gt;Positive&lt;/span&gt; with Cambodia"

$subtitle
[1] "Singapore Trade Balance against selected partners by calendar months, 2020-2022"

$caption
[1] "Merchandise Trade by Region/Market from Department of Statistics, Singapore"

attr(,"class")
[1] "labels"</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="insight" class="level5">
<h5 class="anchored" data-anchor-id="insight">3.2.2.3 Insight</h5>
<section id="overall-singapore-calendar-heatmap" class="level6">
<h6 class="anchored" data-anchor-id="overall-singapore-calendar-heatmap"><u>Overall Singapore Calendar Heatmap</u></h6>
<ul>
<li><u>Trade Volumes</u>: Continue to recover from March 2021 onward post Covid-restriction throughout 2020. The volumes reached peak in March and July 2022. However, slight slowdown is observed from October 2022 following the onset of recession</li>
<li><u>Trade Balance</u>: Similar insight can be garnered from <a href="#sec-3.1.1.3">Section&nbsp;3.1.1.3</a> with Singapore maintaining trade surplus throughout the duration, except for brief period in May 2022. Clear peaks in trade surplus were observed in August 2021, as well as in March and August 2022</li>
<li>No other clear seasonality observed</li>
</ul>
</section>
<section id="selected-countries-calendar-heatmap" class="level6">
<h6 class="anchored" data-anchor-id="selected-countries-calendar-heatmap"><u>Selected Countries Calendar Heatmap</u></h6>
<p>There are a lot of insights to be garnered from here, but only few will be highlighted</p>
<ul>
<li><u>Major Partners</u>: Trade surplus turning deficit for all major partners, especially with Mainland China, United States, and South Korea from end 2021 to 2022, explaining the thinning overall trade surplus</li>
<li><u>Other regional partners</u>: Singapore seems to be maintaining thin surplus with Philippines, which evidently improving from Aug 2022 onward. It is interesting to see the three peaks of trade surplus with Cambodia happening in Mar and Dec 2021, and Jul 2022</li>
<li><u>European partners</u>: Singapore maintains slight trade deficit with Germany and United Kingdom which seems to be reducing towards end 2022. However the same is not true with France and Switzerland, with worsening trade deficit in 2022</li>
<li><u>Other minor partners</u>: The calendar heatmap still favors bigger trading partners as smaller partners are overshadowed by the rest.</li>
</ul>
</section>
</section>
</section>
<section id="singapore-trade-performance-with-selected-countries" class="level4">
<h4 class="anchored" data-anchor-id="singapore-trade-performance-with-selected-countries">3.2.2 Singapore Trade Performance with Selected Countries</h4>
<p>With insights from the previous sections, it makes sense to focus more on Singapore’s trading performance with selected trading partners. Using the same braided ribbon plot from <a href="#sec-3.1.1">Section&nbsp;3.1.1</a>, we can gain a better understanding of import and export trends with individual trading partners.</p>
<section id="design-consideration-2" class="level5">
<h5 class="anchored" data-anchor-id="design-consideration-2">3.2.2.1 Design Consideration</h5>
<ul>
<li><p>Braided ribbon charts helps to visualise the areas between import and export values, highlighting Singapore trade balance with each partner organised in trellis chart.</p></li>
<li><p>To reduce clutter, the words “Export” and “Import” will be color-coded in the title instead of using legend</p></li>
<li><p>Referring to <a href="#sec-3.1.2.4">Section&nbsp;3.1.2.4</a> , the selected partners are categorised into four groups. Each category will have its own subtitle, and the insights for each group will be further expounded upon</p></li>
<li><p>Reference line will be provided, representing the average import and export values in 2020 as explained above in <a href="#sec-3.1.1.1">Section&nbsp;3.1.1.1</a></p></li>
<li><p>To help users understand the scale, the contribution of each trading partner to the total Singapore trade volume will be displayed. This allows each group to have different y-axis scale, helping to bring the minor partners trend to prominence.</p></li>
<li><p>Annotations explaining the events around the world</p></li>
</ul>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some details in the plot can help to enhance the visual aesthetics, such as:</p>
<ul>
<li><p>Using diverging colorblind friendly palette</p></li>
<li><p>Display the values in Billions SGD rather than the raw values</p></li>
<li><p>Using arrows to aid annotations</p></li>
</ul>
</div>
</div>
</section>
<section id="preparation-of-visualisation-2" class="level5">
<h5 class="anchored" data-anchor-id="preparation-of-visualisation-2">3.2.2.2 Preparation of visualisation</h5>
<section id="creating-the-plot-function" class="level6">
<h6 class="anchored" data-anchor-id="creating-the-plot-function"><u>Creating the plot function</u></h6>
<p>Given the design consideration to have individual subtitle for each group of countries, it makes sense patch the title together using <code>patchwork</code> library. As such, the codes to process the data and plot the graph are wrapped in R function, taking in the list of countries for each group as input.</p>
<p>Steps used to create the function:</p>
<ul>
<li><p>Create function called <code>plot_braid_ctry</code>, taking <strong>selected_countries</strong> as input</p></li>
<li><p>Convert the <strong>Countries</strong> variable to factor, ordered by trade volumes in descending order using <code>forcats::fct_reorder()</code></p></li>
<li><p>Create new tibble <strong><em>sgtrade_cln_long</em></strong> which collapses the <strong>Import_SGD</strong> and <strong>Export_SGD</strong> columns to new variable <strong>Type</strong>. This is used for geom_line to allow plotting different lines and grouped them by color. <code>tidyr::pivot_longer()</code> is used to do this.</p></li>
<li><p><strong><em>avg_total_ctry_2020</em></strong> creates 1x3 tibble containing the average 2020 Singapore import and export values by country to draw the reference lines. Firstly <strong><em>sgtrade_cln</em></strong> is filtered for <code>Year == 2020</code>. It is then grouped and summarised by mean of <strong>Import_SGD</strong> and <strong>Export_SGD</strong>.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that min_import_export variable is created as reference variable to place the “Avg 2020” text in the plot</p>
</div>
</div></li>
<li><p>To create dynamic labels in each facet, another function called <code>appender</code> is defined to append the country’s name with each <code>Pct_Total_Trade_Volumes</code></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>paste0()</code> function is used to combine the <strong>Pct_Total_Trade_Volumes</strong> and string “% of Total Volumes”</p>
</div>
</div></li>
<li><p>The rest of the steps mimic the same braided ribbon plot codes created in <a href="#sec-3.1.1.2">Section&nbsp;3.1.1.2</a> Plotting the main graph with the addition of faceting the plots by column using <code>facet_wrap()</code></p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>the <code>appender</code> function is used in the <code>labeller</code> argument of <code>facet_wrap()</code> to create the dynamic labels</p>
</div>
</div></li>
</ul>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Write function so the plots can be patched separately</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>plot_braid_ctry <span class="ot">&lt;-</span> <span class="cf">function</span>(selected_countries) {</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Converting countries to factor, ordered by trade volumes in descending order</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>sgtrade_cln<span class="sc">$</span>Countries <span class="ot">&lt;-</span> <span class="fu">fct_reorder</span>(sgtrade_cln<span class="sc">$</span>Countries, sgtrade_cln<span class="sc">$</span>Total_Trade_Volumes_SGD, <span class="at">.desc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating new tibble to be used for geom_line </span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>sgtrade_cln_long <span class="ot">&lt;-</span> sgtrade_cln <span class="sc">|&gt;</span> </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Month_Year, Countries, Year, Import_SGD, Export_SGD, Pct_Total_Trade_Volumes) <span class="sc">|&gt;</span> </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(Import_SGD, Export_SGD),</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Type"</span>,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Values"</span>)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating new tibble to be used for reference line</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>avg_total_ctry_2020 <span class="ot">&lt;-</span> sgtrade_cln <span class="sc">|&gt;</span> </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span> (Year, Countries) <span class="sc">|&gt;</span> </span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">import =</span> <span class="fu">mean</span>(Import_SGD),</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">export =</span> <span class="fu">mean</span>(Export_SGD)) <span class="sc">|&gt;</span> </span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year_date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(Year, <span class="st">"-01-01"</span>, <span class="at">sep =</span> <span class="st">""</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">min_import_export =</span> <span class="fu">min</span>(import, export))</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating additional label to display % of total trade for every country</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>label_ctry <span class="ot">&lt;-</span> sgtrade_top_ctry <span class="sc">|&gt;</span> </span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Countries <span class="sc">%in%</span> selected_countries)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>Ctry_labels <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,label_ctry<span class="sc">$</span>Pct_Total_Trade_Volumes,<span class="st">"% of Total Volumes"</span>)</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>appender <span class="ot">&lt;-</span> <span class="cf">function</span>(string, <span class="at">suffix =</span> Ctry_labels) <span class="fu">paste0</span>(string, suffix)</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the base plot</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sgtrade_cln_long <span class="sc">|&gt;</span> </span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(Countries <span class="sc">%in%</span> selected_countries)) <span class="sc">+</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> sgtrade_cln_long <span class="sc">|&gt;</span> </span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(Countries <span class="sc">%in%</span> selected_countries),</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> Month_Year,</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> Values,</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> Type),</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">1.2</span>,</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_braid</span>(<span class="at">data =</span> sgtrade_cln <span class="sc">|&gt;</span> </span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(Countries <span class="sc">%in%</span> selected_countries),</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Month_Year,</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ymin =</span> Import_SGD,</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ymax =</span> Export_SGD,</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> Import_SGD <span class="sc">&lt;</span> Export_SGD),</span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a><span class="co">#Remove the legend </span></span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">linetype =</span> <span class="st">"none"</span>, <span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the reference lines with annotations</span></span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">data =</span> avg_total_ctry_2020<span class="sc">|&gt;</span> </span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(Countries <span class="sc">%in%</span> selected_countries),</span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">yintercept =</span> export), </span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">"#0072B2"</span>,</span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth=</span><span class="fl">0.8</span>,</span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">data =</span> avg_total_ctry_2020<span class="sc">|&gt;</span> </span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a>               <span class="fu">filter</span>(Countries <span class="sc">%in%</span> selected_countries),</span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">yintercept =</span> import), </span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">"#D55E00"</span>,</span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth=</span><span class="fl">0.8</span>,</span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb32-70"><a href="#cb32-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-71"><a href="#cb32-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> avg_total_ctry_2020<span class="sc">|&gt;</span> </span>
<span id="cb32-72"><a href="#cb32-72" aria-hidden="true" tabindex="-1"></a>               <span class="fu">filter</span>(Countries <span class="sc">%in%</span> selected_countries),</span>
<span id="cb32-73"><a href="#cb32-73" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> Year_date,</span>
<span id="cb32-74"><a href="#cb32-74" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> min_import_export <span class="sc">-</span> <span class="fl">0.25</span><span class="sc">*</span>min_import_export,</span>
<span id="cb32-75"><a href="#cb32-75" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="st">"Avg 2020"</span>),</span>
<span id="cb32-76"><a href="#cb32-76" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">3.5</span>,</span>
<span id="cb32-77"><a href="#cb32-77" aria-hidden="true" tabindex="-1"></a>            <span class="at">nudge_x =</span> <span class="sc">+</span><span class="dv">920</span>) <span class="sc">+</span></span>
<span id="cb32-78"><a href="#cb32-78" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb32-79"><a href="#cb32-79" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting the colors for the main plot  </span></span>
<span id="cb32-80"><a href="#cb32-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>),</span>
<span id="cb32-81"><a href="#cb32-81" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Export"</span>, <span class="st">"Import"</span>),</span>
<span id="cb32-82"><a href="#cb32-82" aria-hidden="true" tabindex="-1"></a>                     <span class="at">name =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb32-83"><a href="#cb32-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-84"><a href="#cb32-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>)) <span class="sc">+</span></span>
<span id="cb32-85"><a href="#cb32-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-86"><a href="#cb32-86" aria-hidden="true" tabindex="-1"></a><span class="co">#Adjusting the scale</span></span>
<span id="cb32-87"><a href="#cb32-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb32-88"><a href="#cb32-88" aria-hidden="true" tabindex="-1"></a>               <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"2020-01-01"</span>),<span class="fu">as.Date</span>(<span class="st">"2022-12-31"</span>)),</span>
<span id="cb32-89"><a href="#cb32-89" aria-hidden="true" tabindex="-1"></a>               <span class="at">date_breaks =</span> <span class="st">"1 year"</span>,</span>
<span id="cb32-90"><a href="#cb32-90" aria-hidden="true" tabindex="-1"></a>               <span class="at">date_labels =</span> <span class="st">"%Y"</span>) <span class="sc">+</span></span>
<span id="cb32-91"><a href="#cb32-91" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-92"><a href="#cb32-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Trade Values"</span>,</span>
<span id="cb32-93"><a href="#cb32-93" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="cf">function</span>(x){<span class="fu">paste0</span>(<span class="st">'$'</span>, <span class="fu">abs</span>(x<span class="sc">/</span><span class="dv">1000000000</span>),<span class="st">'B'</span>)}) <span class="sc">+</span></span>
<span id="cb32-94"><a href="#cb32-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-95"><a href="#cb32-95" aria-hidden="true" tabindex="-1"></a><span class="co">#Faceted based on Countries  </span></span>
<span id="cb32-96"><a href="#cb32-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Countries), <span class="at">ncol=</span><span class="dv">4</span>, <span class="at">labeller=</span><span class="fu">as_labeller</span>(appender)) <span class="sc">+</span></span>
<span id="cb32-97"><a href="#cb32-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-98"><a href="#cb32-98" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting the theme</span></span>
<span id="cb32-99"><a href="#cb32-99" aria-hidden="true" tabindex="-1"></a>  cowplot<span class="sc">::</span><span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb32-100"><a href="#cb32-100" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-101"><a href="#cb32-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb32-102"><a href="#cb32-102" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey90"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>),</span>
<span id="cb32-103"><a href="#cb32-103" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"grey60"</span>, <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb32-104"><a href="#cb32-104" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.spacing.x =</span> <span class="fu">unit</span>(<span class="dv">0</span>,<span class="st">"line"</span>),</span>
<span id="cb32-105"><a href="#cb32-105" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.spacing.y =</span> <span class="fu">unit</span>(<span class="dv">0</span>,<span class="st">"line"</span>)) </span>
<span id="cb32-106"><a href="#cb32-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-107"><a href="#cb32-107" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plotting-the-main-visualisation" class="level6">
<h6 class="anchored" data-anchor-id="plotting-the-main-visualisation"><u>Plotting the main visualisation</u></h6>
<p>As there are four groups of countries, we will create four separate plots, namely p1, p2, p3 and p4, representing Major Partners, Other Regional Partners, European Partners, and Other Minor Partners respectively.</p>
<p>Steps used to create the visualisation:</p>
<ul>
<li><p>To allow individual annotations in each facet, we need to specify the annotations for each plot, defining the label and arrows arguments. Each label and arrow arguments are combined into dataframe, created using <code>data.frame()</code> function to combine the <code>label</code>, <strong>Countries</strong>, <code>x</code>, and <code>y</code> coordinates of the text.</p></li>
<li><p>Each plot is created using the <code>plot_braid_ctry()</code> function defined above with list of countries from each group as input. After which, the following functions are used</p>
<ul>
<li><p>geom_label() is used to display the annotation in label format, taking input of label dataframe created above</p></li>
<li><p>geom_segment() is used to display the arrow, taking input of arrow dataframe created above</p></li>
<li><p>Set the theme and add titles, subtitles, and captions using <code>theme()</code> and <code>labs()</code> functions</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>element_markdown()</code> argument is set in <code>theme()</code> to enable markdown text to be specified in the <code>labs(title)</code>. This will allow specific color to be set on “Export” and “Import”.</p>
</div>
</div></li>
</ul></li>
</ul>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Specifying the annotation for p1</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>p1_text <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Zero Covid Policy</span><span class="sc">\n</span><span class="st">War in Ukraine"</span>, <span class="st">""</span>, <span class="st">"War in Ukraine"</span>, <span class="st">"Covid recovery"</span>),  </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Countries =</span> <span class="fu">c</span>(<span class="st">"Mainland China"</span>, <span class="st">"Malaysia"</span>, <span class="st">"United States"</span>, <span class="st">"South Korea"</span>),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">x =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"2021-01-01"</span>), <span class="dv">0</span>, <span class="fu">as.Date</span>(<span class="st">"2021-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2020-10-01"</span>)),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1500000000</span>, <span class="dv">0</span>, <span class="dv">1500000000</span>, <span class="dv">7500000000</span>))</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>arrowp1<span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Countries =</span> <span class="fu">c</span>(<span class="st">"Mainland China"</span>, <span class="st">"Malaysia"</span>, <span class="st">"United States"</span>, <span class="st">"South Korea"</span>),</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"2021-01-01"</span>), <span class="dv">0</span>, <span class="fu">as.Date</span>(<span class="st">"2021-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2020-10-01"</span>)),</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">2700000000</span>, <span class="dv">0</span>, <span class="dv">2100000000</span>, <span class="dv">7000000000</span>),</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xend =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"2022-02-01"</span>), <span class="dv">0</span>, <span class="fu">as.Date</span>(<span class="st">"2022-02-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2021-04-01"</span>)),</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">yend =</span> <span class="fu">c</span>(<span class="dv">4500000000</span>, <span class="dv">0</span>, <span class="dv">4100000000</span>, <span class="dv">2500000000</span>))</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>p1_text<span class="sc">$</span>Countries <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"Mainland China"</span>, <span class="st">"Malaysia"</span>, <span class="st">"United States"</span>, <span class="st">"South Korea"</span>))</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>arrowp1<span class="sc">$</span>Countries <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"Mainland China"</span>, <span class="st">"Malaysia"</span>, <span class="st">"United States"</span>, <span class="st">"South Korea"</span>))</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Specifying the annotation for p2</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>p2_text <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Start of</span><span class="sc">\n</span><span class="st">recession"</span>, <span class="st">"Covid Waves"</span>, <span class="st">"Start of</span><span class="sc">\n</span><span class="st">recession"</span>, <span class="st">"Reversal in</span><span class="sc">\n</span><span class="st">Balance"</span>),  </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Countries =</span> <span class="fu">c</span>(<span class="st">"Australia"</span>, <span class="st">"India"</span>, <span class="st">"Philippines"</span>, <span class="st">"Cambodia"</span>),</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">x =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"2020-08-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2020-10-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2020-08-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2020-09-01"</span>)),</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">2000000000</span>, <span class="dv">2000000000</span>, <span class="dv">2000000000</span>, <span class="dv">2000000000</span>))</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>arrowp2<span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Countries =</span> <span class="fu">c</span>(<span class="st">"Australia"</span>, <span class="st">"India"</span>, <span class="st">"Philippines"</span>, <span class="st">"Cambodia"</span>),</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"2021-02-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2020-10-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2021-02-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2020-09-01"</span>)),</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">2000000000</span>, <span class="dv">1850000000</span>, <span class="dv">2000000000</span>, <span class="dv">1700000000</span>),</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xend =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"2022-07-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2020-04-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2022-07-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2020-10-01"</span>)),</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">yend =</span> <span class="fu">c</span>(<span class="dv">2000000000</span>, <span class="dv">600000000</span>, <span class="dv">1400000000</span>, <span class="dv">200000000</span>))</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>arrowp2a<span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Countries =</span> <span class="fu">c</span>(<span class="st">"Australia"</span>, <span class="st">"India"</span>, <span class="st">"Philippines"</span>, <span class="st">"Cambodia"</span>),</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"1970-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2020-10-01"</span>), <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1850000000</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xend =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"1970-01-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2021-06-01"</span>), <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>                      <span class="at">yend =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1100000000</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>p2_text<span class="sc">$</span>Countries <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"Australia"</span>, <span class="st">"India"</span>, <span class="st">"Philippines"</span>, <span class="st">"Cambodia"</span>))</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>arrowp2<span class="sc">$</span>Countries <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"Australia"</span>, <span class="st">"India"</span>, <span class="st">"Philippines"</span>, <span class="st">"Cambodia"</span>))</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>arrowp2a<span class="sc">$</span>Countries <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"Australia"</span>, <span class="st">"India"</span>, <span class="st">"Philippines"</span>, <span class="st">"Cambodia"</span>))</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a><span class="co">#Specifying the annotation for p3</span></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>p3_text <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Surge in</span><span class="sc">\n</span><span class="st">Exports"</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">"Surge in</span><span class="sc">\n</span><span class="st">Exports"</span>),  </span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Countries =</span> <span class="fu">c</span>(<span class="st">"Germany"</span>, <span class="st">"France"</span>, <span class="st">"Switzerland"</span>, <span class="st">"United Kingdom"</span>),</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>                         <span class="at">x =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"2020-9-01"</span>), <span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">as.Date</span>(<span class="st">"2022-6-01"</span>)),</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1700000000</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1700000000</span>))</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>arrowp3<span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Countries =</span> <span class="fu">c</span>(<span class="st">"Germany"</span>, <span class="st">"France"</span>, <span class="st">"Switzerland"</span>, <span class="st">"United Kingdom"</span>),</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"2021-02-01"</span>), <span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">as.Date</span>(<span class="st">"2022-01-01"</span>)),</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1700000000</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1700000000</span>),</span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xend =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"2022-08-01"</span>), <span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">as.Date</span>(<span class="st">"2020-09-01"</span>)),</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>                      <span class="at">yend =</span> <span class="fu">c</span>(<span class="dv">1300000000</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1200000000</span>))</span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a>p3_text<span class="sc">$</span>Countries <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"Germany"</span>, <span class="st">"France"</span>, <span class="st">"Switzerland"</span>, <span class="st">"United Kingdom"</span>))</span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>arrowp3<span class="sc">$</span>Countries <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"Germany"</span>, <span class="st">"France"</span>, <span class="st">"Switzerland"</span>, <span class="st">"United Kingdom"</span>))</span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a><span class="co">#Specifying the annotation for p4</span></span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>p4_text <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Reduced Trade</span><span class="sc">\n</span><span class="st">Deficit"</span>, <span class="st">"Enhanced</span><span class="sc">\n</span><span class="st">Partnership"</span>, <span class="st">"Surge in</span><span class="sc">\n</span><span class="st">Imports"</span>, <span class="st">"Surge in</span><span class="sc">\n</span><span class="st">Imports"</span>),  </span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Countries =</span> <span class="fu">c</span>(<span class="st">"Mexico"</span>, <span class="st">"New Zealand"</span>, <span class="st">"Canada"</span>, <span class="st">"Brunei Darussalam"</span>),</span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a>                         <span class="at">x =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"2020-12-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2020-10-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2020-10-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2020-10-01"</span>)),</span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">600000000</span>, <span class="dv">600000000</span>, <span class="dv">600000000</span>, <span class="dv">600000000</span>))</span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a>arrowp4<span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Countries =</span> <span class="fu">c</span>(<span class="st">"Mexico"</span>, <span class="st">"New Zealand"</span>, <span class="st">"Canada"</span>, <span class="st">"Brunei Darussalam"</span>),</span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"2021-9-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2021-05-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2021-03-15"</span>), <span class="fu">as.Date</span>(<span class="st">"2021-03-15"</span>)),</span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">600000000</span>, <span class="dv">600000000</span>, <span class="dv">600000000</span>, <span class="dv">600000000</span>),</span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xend =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">"2022-02-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2022-03-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2022-05-01"</span>), <span class="fu">as.Date</span>(<span class="st">"2022-07-01"</span>)),</span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a>                      <span class="at">yend =</span> <span class="fu">c</span>(<span class="dv">250000000</span>, <span class="dv">300000000</span>, <span class="dv">400000000</span>, <span class="dv">550000000</span>))</span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true" tabindex="-1"></a>p4_text<span class="sc">$</span>Countries <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"Mexico"</span>, <span class="st">"New Zealand"</span>, <span class="st">"Brunei Darussalam"</span>, <span class="st">"Canada"</span>))</span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true" tabindex="-1"></a>arrowp4<span class="sc">$</span>Countries <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"Mexico"</span>, <span class="st">"New Zealand"</span>, <span class="st">"Brunei Darussalam"</span>, <span class="st">"Canada"</span>))</span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the graph</span></span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true" tabindex="-1"></a>p1a <span class="ot">&lt;-</span> <span class="fu">plot_braid_ctry</span>(<span class="fu">c</span>(<span class="st">"Mainland China"</span>, <span class="st">"Malaysia"</span>, <span class="st">"United States"</span>, <span class="st">"South Korea"</span>))</span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> p1a <span class="sc">+</span> </span>
<span id="cb33-76"><a href="#cb33-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">data =</span> p1_text,</span>
<span id="cb33-77"><a href="#cb33-77" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb33-78"><a href="#cb33-78" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> y,</span>
<span id="cb33-79"><a href="#cb33-79" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb33-80"><a href="#cb33-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> arrowp1, </span>
<span id="cb33-81"><a href="#cb33-81" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y, <span class="at">yend =</span> yend), </span>
<span id="cb33-82"><a href="#cb33-82" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">alpha=</span><span class="fl">0.9</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>,<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">"inches"</span>))) <span class="sc">+</span></span>
<span id="cb33-83"><a href="#cb33-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Singapore merchandise trade volume with ***major partners*** rebounds amid Covid-19 recovery, but deficit worsens;&lt;br&gt;recession shrinks trade further in mid-2022"</span>) <span class="sc">+</span></span>
<span id="cb33-84"><a href="#cb33-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb33-85"><a href="#cb33-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-86"><a href="#cb33-86" aria-hidden="true" tabindex="-1"></a>p2a <span class="ot">&lt;-</span> <span class="fu">plot_braid_ctry</span>(<span class="fu">c</span>(<span class="st">"Australia"</span>, <span class="st">"India"</span>, <span class="st">"Philippines"</span>, <span class="st">"Cambodia"</span>))</span>
<span id="cb33-87"><a href="#cb33-87" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p2a <span class="sc">+</span> </span>
<span id="cb33-88"><a href="#cb33-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">data =</span> p2_text,</span>
<span id="cb33-89"><a href="#cb33-89" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb33-90"><a href="#cb33-90" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> y,</span>
<span id="cb33-91"><a href="#cb33-91" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb33-92"><a href="#cb33-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> arrowp2, </span>
<span id="cb33-93"><a href="#cb33-93" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y, <span class="at">yend =</span> yend), </span>
<span id="cb33-94"><a href="#cb33-94" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">alpha=</span><span class="fl">0.9</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>,<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">"inches"</span>))) <span class="sc">+</span></span>
<span id="cb33-95"><a href="#cb33-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> arrowp2a, </span>
<span id="cb33-96"><a href="#cb33-96" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y, <span class="at">yend =</span> yend), </span>
<span id="cb33-97"><a href="#cb33-97" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">alpha=</span><span class="fl">0.9</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>,<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">"inches"</span>))) <span class="sc">+</span></span>
<span id="cb33-98"><a href="#cb33-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"&lt;span style = 'color:#0072B2'&gt;Exports&lt;/span&gt; bounced back with ***other regional partners*** with Covid-19 recovery; but hit by recession in 2022"</span>) <span class="sc">+</span></span>
<span id="cb33-99"><a href="#cb33-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb33-100"><a href="#cb33-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-101"><a href="#cb33-101" aria-hidden="true" tabindex="-1"></a>p3a <span class="ot">&lt;-</span> <span class="fu">plot_braid_ctry</span>(<span class="fu">c</span>(<span class="st">"Germany"</span>, <span class="st">"France"</span>, <span class="st">"Switzerland"</span>, <span class="st">"United Kingdom"</span>))</span>
<span id="cb33-102"><a href="#cb33-102" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> p3a <span class="sc">+</span> </span>
<span id="cb33-103"><a href="#cb33-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">data =</span> p3_text,</span>
<span id="cb33-104"><a href="#cb33-104" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb33-105"><a href="#cb33-105" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> y,</span>
<span id="cb33-106"><a href="#cb33-106" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb33-107"><a href="#cb33-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> arrowp3, </span>
<span id="cb33-108"><a href="#cb33-108" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y, <span class="at">yend =</span> yend), </span>
<span id="cb33-109"><a href="#cb33-109" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">alpha=</span><span class="fl">0.9</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>,<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">"inches"</span>))) <span class="sc">+</span></span>
<span id="cb33-110"><a href="#cb33-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"&lt;span style = 'color:#D55E00'&gt;Imports&lt;/span&gt; rise and volatility worsens amid Covid-19 recovery, but exports to ***major European partners*** stay sluggish"</span>) <span class="sc">+</span></span>
<span id="cb33-111"><a href="#cb33-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb33-112"><a href="#cb33-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-113"><a href="#cb33-113" aria-hidden="true" tabindex="-1"></a>p4a <span class="ot">&lt;-</span> <span class="fu">plot_braid_ctry</span>(<span class="fu">c</span>(<span class="st">"Mexico"</span>, <span class="st">"New Zealand"</span>, <span class="st">"Canada"</span>, <span class="st">"Brunei Darussalam"</span>))</span>
<span id="cb33-114"><a href="#cb33-114" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> p4a <span class="sc">+</span> </span>
<span id="cb33-115"><a href="#cb33-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">data =</span> p4_text,</span>
<span id="cb33-116"><a href="#cb33-116" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb33-117"><a href="#cb33-117" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> y,</span>
<span id="cb33-118"><a href="#cb33-118" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb33-119"><a href="#cb33-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> arrowp4, </span>
<span id="cb33-120"><a href="#cb33-120" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y, <span class="at">yend =</span> yend), </span>
<span id="cb33-121"><a href="#cb33-121" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">alpha=</span><span class="fl">0.9</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>,<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">"inches"</span>))) <span class="sc">+</span></span>
<span id="cb33-122"><a href="#cb33-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Trade volume also makes recovery with ***minor partners*** in 2022, with &lt;span style = 'color:#0072B2'&gt;exports&lt;/span&gt; growing to Mexico and New Zealand"</span>) <span class="sc">+</span></span>
<span id="cb33-123"><a href="#cb33-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb33-124"><a href="#cb33-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-125"><a href="#cb33-125" aria-hidden="true" tabindex="-1"></a><span class="co">#Patching everything together</span></span>
<span id="cb33-126"><a href="#cb33-126" aria-hidden="true" tabindex="-1"></a>final_plot <span class="ot">&lt;-</span> p1 <span class="sc">/</span> p2 <span class="sc">/</span> p3 <span class="sc">/</span> p4</span>
<span id="cb33-127"><a href="#cb33-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-128"><a href="#cb33-128" aria-hidden="true" tabindex="-1"></a>final_plot <span class="sc">+</span> <span class="fu">plot_annotation</span>(</span>
<span id="cb33-129"><a href="#cb33-129" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Merchandise &lt;span style = 'color:#0072B2'&gt;Export&lt;/span&gt; and &lt;span style = 'color:#D55E00'&gt;Import&lt;/span&gt; Trade Values of Singapore (in SGD)&lt;br&gt;with selected trading partners, 2020-2022"</span>,</span>
<span id="cb33-130"><a href="#cb33-130" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Merchandise Trade by Region/Market from Department of Statistics, Singapore"</span>,</span>
<span id="cb33-131"><a href="#cb33-131" aria-hidden="true" tabindex="-1"></a>  <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_markdown</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">18</span>))</span>
<span id="cb33-132"><a href="#cb33-132" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/Singapore Trade Balance Plot-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
</section>
<section id="insights-1" class="level5">
<h5 class="anchored" data-anchor-id="insights-1">3.2.2.3 Insights</h5>
<ul>
<li><p><u>Major partners</u>: Trade volume has rebounded since Covid-19, but the trade deficit worsened from 2022. A sudden drop in trade with China, Malaysia, and the USA occurred in early 2022 due to major Shanghai lockdown and the start of the war in Ukraine. Trade volume shrinks in mid-2022 likely due to the recession</p></li>
<li><p><u>Other regional partners</u>: Exports rebounded after Covid-19, resulting in a surplus. However, trade starts to drop in mid-2022 due to the recession. The impact of two major Covid waves in India is evident, and trade with Cambodia showed a major surplus from Q3 2020</p></li>
<li><p><u>European partners</u>: There is high volatility in trade amid Covid-19 recovery, with a rise in imports and sluggish exports, worsening Singapore’s trade deficit. There was a surge in exports to France, the UK, and Germany in 2020/2022</p></li>
<li><p><u>Other minor partners</u>: Trade volume has rebounded, with rising exports to New Zealand (signed Enhanced Partnership) and reduced deficit with Mexico. However, there was a large surge of imports from Canada and Brunei in Q2/Q3 2022.</p></li>
</ul>
</section>
</section>
<section id="year-over-year-changes-between-2020-and-2022" class="level4">
<h4 class="anchored" data-anchor-id="year-over-year-changes-between-2020-and-2022">3.2.3 Year-over-Year changes between 2020 and 2022</h4>
<p>Choose Q3 as Q3 2020 is during the major lockdowns around the world and it is just prior to recession in 2022. Providing a bit of stability in the data</p>
<p>Modifying the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>sgtrade_cln_qtr <span class="ot">&lt;-</span> sgtrade_cln <span class="sc">|&gt;</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Quarter =</span> <span class="fu">factor</span>(<span class="fu">paste0</span>(<span class="st">"Q"</span>, <span class="fu">quarter</span>(Month_Year), <span class="st">" "</span>, <span class="fu">year</span>(Month_Year))), <span class="at">.after =</span> Month) <span class="sc">|&gt;</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Quarter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Q3 2020"</span>, <span class="st">"Q3 2022"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Countries, Quarter) <span class="sc">|&gt;</span> </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total_Trade_Balance_BSGD =</span> <span class="fu">round</span>(<span class="fu">sum</span>(Trade_Balance_SGD)<span class="sc">/</span><span class="dv">1000000000</span>, <span class="dv">2</span>),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">Total_Trade_Volumes_BSGD =</span> <span class="fu">round</span>(<span class="fu">sum</span>(Trade_Volumes_SGD)<span class="sc">/</span><span class="dv">1000000000</span>, <span class="dv">2</span>),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">Total_Import_BSGD =</span> <span class="fu">round</span>(<span class="fu">sum</span>(Import_SGD)<span class="sc">/</span><span class="dv">1000000000</span>, <span class="dv">2</span>),</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">Total_Export_BSGD =</span> <span class="fu">round</span>(<span class="fu">sum</span>(Export_SGD)<span class="sc">/</span><span class="dv">1000000000</span>, <span class="dv">2</span>))</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>sgtrade_cln_qtr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 104 × 6
# Groups:   Countries [52]
   Countries  Quarter Total_Trade_Balance_BSGD Total_Trade_Vol…¹ Total…² Total…³
   &lt;chr&gt;      &lt;fct&gt;                      &lt;dbl&gt;             &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 Australia  Q3 2020                     1.98              4.37    1.2     3.18
 2 Australia  Q3 2022                     3.17              9.31    3.07    6.24
 3 Austria    Q3 2020                    -0.14              0.28    0.21    0.07
 4 Austria    Q3 2022                    -0.23              0.48    0.35    0.13
 5 Bahrain    Q3 2020                    -0.13              0.17    0.15    0.02
 6 Bahrain    Q3 2022                    -0.08              0.28    0.18    0.1 
 7 Bangladesh Q3 2020                     0.74              0.85    0.06    0.79
 8 Bangladesh Q3 2022                     1.56              1.71    0.07    1.64
 9 Belgium    Q3 2020                     0.75              1.32    0.28    1.04
10 Belgium    Q3 2022                     1.38              2.52    0.57    1.95
# … with 94 more rows, and abbreviated variable names
#   ¹​Total_Trade_Volumes_BSGD, ²​Total_Import_BSGD, ³​Total_Export_BSGD</code></pre>
</div>
</div>
<p>Creating function to plot Trade Balances</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Trade Volume</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Import</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Export</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false">Trade Balance</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>plot_slopegraph_tradevol <span class="ot">&lt;-</span> <span class="cf">function</span>(selected_countries) {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  custom_colors_tradevol <span class="ot">&lt;-</span> sgtrade_cln_qtr <span class="sc">|&gt;</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> Countries,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">names_from =</span> Quarter,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">values_from =</span> Total_Trade_Volumes_BSGD) <span class="sc">|&gt;</span> </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">diff_Total_Trade_Volumes =</span> <span class="st">`</span><span class="at">Q3 2022</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">Q3 2020</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">col_Total_Trade_Volumes =</span> <span class="fu">case_when</span>(</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>      diff_Total_Trade_Volumes <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">~</span><span class="st">"#0072B2"</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>      diff_Total_Trade_Volumes <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">3</span> <span class="sc">~</span><span class="st">"#D55E00"</span>,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"grey"</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span> </span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Countries, col_Total_Trade_Volumes) <span class="sc">|&gt;</span> </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">deframe</span>()</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">newggslopegraph</span>(<span class="at">dataframe =</span> sgtrade_cln_qtr <span class="sc">|&gt;</span> </span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">filter</span>(Countries <span class="sc">%in%</span> selected_countries),</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Times =</span> Quarter,</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Measurement =</span> Total_Trade_Volumes_BSGD,</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Grouping =</span> Countries,</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Title =</span> <span class="st">"Y-o-Y Change in Singapore Merchandise Trade Volumes (Billion SGD)"</span>,</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">SubTitle =</span> <span class="st">"Q3 2020 to Q3 2022"</span>,</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Caption =</span> <span class="st">"Merchandise Trade by Region/Market from Department of Statistics, Singapore"</span>,</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">LineColor =</span> custom_colors_tradevol,</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">LineThickness =</span> <span class="fl">0.7</span>,</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ThemeChoice =</span> <span class="st">"gdocs"</span>,</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">WiderLabels =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>plot_slopegraph_import <span class="ot">&lt;-</span> <span class="cf">function</span>(selected_countries) {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  custom_colors_import <span class="ot">&lt;-</span> sgtrade_cln_qtr <span class="sc">|&gt;</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> Countries,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">names_from =</span> Quarter,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">values_from =</span> Total_Import_BSGD) <span class="sc">|&gt;</span> </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">diff_Total_Import =</span> <span class="st">`</span><span class="at">Q3 2022</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">Q3 2020</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">col_Total_Import =</span> <span class="fu">case_when</span>(</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>      diff_Total_Import <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">~</span><span class="st">"#D55E00"</span>,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>      diff_Total_Import <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">~</span><span class="st">"#0072B2"</span>,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"grey"</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span> </span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Countries, col_Total_Import) <span class="sc">|&gt;</span> </span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">deframe</span>()</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">newggslopegraph</span>(<span class="at">dataframe =</span> sgtrade_cln_qtr <span class="sc">|&gt;</span> </span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">filter</span>(Countries <span class="sc">%in%</span> selected_countries),</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Times =</span> Quarter,</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Measurement =</span> Total_Import_BSGD,</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Grouping =</span> Countries,</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Title =</span> <span class="st">"Y-o-Y Change in Singapore Merchandise Import Values (Billion SGD)"</span>,</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">SubTitle =</span> <span class="st">"Q3 2020 to Q3 2022"</span>,</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Caption =</span> <span class="st">"Merchandise Trade by Region/Market from Department of Statistics, Singapore"</span>,</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">LineColor =</span> custom_colors_import,</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">LineThickness =</span> <span class="fl">0.7</span>,</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ThemeChoice =</span> <span class="st">"gdocs"</span>,</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">WiderLabels =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>plot_slopegraph_export <span class="ot">&lt;-</span> <span class="cf">function</span>(selected_countries) {</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  custom_colors_export <span class="ot">&lt;-</span> sgtrade_cln_qtr <span class="sc">|&gt;</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> Countries,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">names_from =</span> Quarter,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">values_from =</span> Total_Export_BSGD) <span class="sc">|&gt;</span> </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">diff_Total_Export =</span> <span class="st">`</span><span class="at">Q3 2022</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">Q3 2020</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">col_Total_Export =</span> <span class="fu">case_when</span>(</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>      diff_Total_Export <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">~</span><span class="st">"#0072B2"</span>,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>      diff_Total_Export <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">~</span><span class="st">"#D55E00"</span>,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"grey"</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span> </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Countries, col_Total_Export) <span class="sc">|&gt;</span> </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">deframe</span>()</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">newggslopegraph</span>(<span class="at">dataframe =</span> sgtrade_cln_qtr <span class="sc">|&gt;</span> </span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">filter</span>(Countries <span class="sc">%in%</span> selected_countries),</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Times =</span> Quarter,</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Measurement =</span> Total_Export_BSGD,</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Grouping =</span> Countries,</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Title =</span> <span class="st">"Y-o-Y Change in Singapore Merchandise Export Values (Billion SGD)"</span>,</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">SubTitle =</span> <span class="st">"Q3 2020 to Q3 2022"</span>,</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Caption =</span> <span class="st">"Merchandise Trade by Region/Market from Department of Statistics, Singapore"</span>,</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">LineColor =</span> custom_colors_export,</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">LineThickness =</span> <span class="fl">0.7</span>,</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ThemeChoice =</span> <span class="st">"gdocs"</span>,</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">WiderLabels =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>plot_slopegraph_tradebal <span class="ot">&lt;-</span> <span class="cf">function</span>(selected_countries) {</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  custom_colors_tradebal <span class="ot">&lt;-</span> sgtrade_cln_qtr <span class="sc">|&gt;</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> Countries,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">names_from =</span> Quarter,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">values_from =</span> Total_Trade_Balance_BSGD) <span class="sc">|&gt;</span> </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">diff_Total_Trade_Balance =</span> <span class="st">`</span><span class="at">Q3 2022</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">Q3 2020</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">col_Total_Trade_Balance =</span> <span class="fu">case_when</span>(</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>      diff_Total_Trade_Balance <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="sc">~</span><span class="st">"#0072B2"</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>      diff_Total_Trade_Balance <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fl">0.5</span> <span class="sc">~</span><span class="st">"#D55E00"</span>,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"grey"</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span> </span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Countries, col_Total_Trade_Balance) <span class="sc">|&gt;</span> </span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">deframe</span>()</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">newggslopegraph</span>(<span class="at">dataframe =</span> sgtrade_cln_qtr <span class="sc">|&gt;</span> </span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">filter</span>(Countries <span class="sc">%in%</span> selected_countries),</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Times =</span> Quarter,</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Measurement =</span> Total_Trade_Balance_BSGD,</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Grouping =</span> Countries,</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Title =</span> <span class="st">"Y-o-Y Change in Singapore Merchandise Trade Balance (Billion SGD)"</span>,</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">SubTitle =</span> <span class="st">"Q3 2020 to Q3 2022"</span>,</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Caption =</span> <span class="st">"Merchandise Trade by Region/Market from Department of Statistics, Singapore"</span>,</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">LineColor =</span> custom_colors_tradebal,</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">LineThickness =</span> <span class="fl">0.7</span>,</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ThemeChoice =</span> <span class="st">"gdocs"</span>,</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">WiderLabels =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Trade Volume</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Import</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">Export</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false">Trade Balance</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_slopegraph_tradevol</span>(<span class="fu">c</span>(<span class="st">"Mainland China"</span>, <span class="st">"Malaysia"</span>, <span class="st">"United States"</span>, <span class="st">"South Korea"</span>, <span class="st">"Australia"</span>, <span class="st">"India"</span>, <span class="st">"Philippines"</span>, <span class="st">"Cambodia"</span>, <span class="st">"Germany"</span>, <span class="st">"France"</span>, <span class="st">"Switzerland"</span>, <span class="st">"United Kingdom"</span>, <span class="st">"Mexico"</span>, <span class="st">"New Zealand"</span>, <span class="st">"Canada"</span>, <span class="st">"Brunei Darussalam"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/Trade Volume Slope Graph-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_slopegraph_import</span>(<span class="fu">c</span>(<span class="st">"Mainland China"</span>, <span class="st">"Malaysia"</span>, <span class="st">"United States"</span>, <span class="st">"South Korea"</span>, <span class="st">"Australia"</span>, <span class="st">"India"</span>, <span class="st">"Philippines"</span>, <span class="st">"Cambodia"</span>, <span class="st">"Germany"</span>, <span class="st">"France"</span>, <span class="st">"Switzerland"</span>, <span class="st">"United Kingdom"</span>, <span class="st">"Mexico"</span>, <span class="st">"New Zealand"</span>, <span class="st">"Canada"</span>, <span class="st">"Brunei Darussalam"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/Import Slope Graph-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_slopegraph_export</span>(<span class="fu">c</span>(<span class="st">"Mainland China"</span>, <span class="st">"Malaysia"</span>, <span class="st">"United States"</span>, <span class="st">"South Korea"</span>, <span class="st">"Australia"</span>, <span class="st">"India"</span>, <span class="st">"Philippines"</span>, <span class="st">"Cambodia"</span>, <span class="st">"Germany"</span>, <span class="st">"France"</span>, <span class="st">"Switzerland"</span>, <span class="st">"United Kingdom"</span>, <span class="st">"Mexico"</span>, <span class="st">"New Zealand"</span>, <span class="st">"Canada"</span>, <span class="st">"Brunei Darussalam"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/Export Slope Graph-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_slopegraph_tradebal</span>(<span class="fu">c</span>(<span class="st">"Mainland China"</span>, <span class="st">"Malaysia"</span>, <span class="st">"United States"</span>, <span class="st">"South Korea"</span>, <span class="st">"Australia"</span>, <span class="st">"India"</span>, <span class="st">"Philippines"</span>, <span class="st">"Cambodia"</span>, <span class="st">"Germany"</span>, <span class="st">"France"</span>, <span class="st">"Switzerland"</span>, <span class="st">"United Kingdom"</span>, <span class="st">"Mexico"</span>, <span class="st">"New Zealand"</span>, <span class="st">"Canada"</span>, <span class="st">"Brunei Darussalam"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Take-home_Ex04_files/figure-html/Trade Balance Slope Graph-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</div>
</div>
</div>
<section id="section-2" class="level6">
<h6 class="anchored" data-anchor-id="section-2"></h6>
</section>
</section>
</section>
<section id="changes-in-import-and-export-over-time" class="level3">
<h3 class="anchored" data-anchor-id="changes-in-import-and-export-over-time">3.3 Changes in Import and Export over time</h3>
<section id="data-preparation-4" class="level4">
<h4 class="anchored" data-anchor-id="data-preparation-4">3.3.1 Data Preparation</h4>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>regions_cln <span class="ot">&lt;-</span> regions <span class="sc">|&gt;</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Countries =</span> <span class="fu">case_when</span>(Countries <span class="sc">==</span> <span class="st">"Brunei"</span> <span class="sc">~</span> <span class="st">"Brunei Darussalam"</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                                 Countries <span class="sc">==</span> <span class="st">"Czechia"</span> <span class="sc">~</span> <span class="st">"Czech Republic"</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                                 Countries <span class="sc">==</span> <span class="st">"China"</span> <span class="sc">~</span> <span class="st">"Mainland China"</span>,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="cn">TRUE</span><span class="sc">~</span>Countries))</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>sgtrade_cln_ani <span class="ot">&lt;-</span> sgtrade_cln <span class="sc">|&gt;</span> </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Month_Year, Countries, Import_SGD, Export_SGD, Trade_Volumes_SGD) <span class="sc">|&gt;</span> </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Import_SGD =</span> <span class="fu">round</span>(Import_SGD<span class="sc">/</span><span class="dv">1000000000</span>, <span class="dv">1</span>),</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">Export_SGD =</span> <span class="fu">round</span>(Export_SGD<span class="sc">/</span><span class="dv">1000000000</span>, <span class="dv">1</span>),</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">Trade_Volumes_SGD =</span> <span class="fu">round</span>(Trade_Volumes_SGD<span class="sc">/</span><span class="dv">1000000000</span>, <span class="dv">1</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(regions_cln, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'Countries'</span> <span class="ot">=</span> <span class="st">'Countries'</span>))</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>sgtrade_cln_ani</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,872 × 6
   Month_Year Countries Import_SGD Export_SGD Trade_Volumes_SGD Region          
   &lt;date&gt;     &lt;chr&gt;          &lt;dbl&gt;      &lt;dbl&gt;             &lt;dbl&gt; &lt;chr&gt;           
 1 2022-12-01 Belgium          0.1        0.4               0.5 Europe and Cent…
 2 2022-11-01 Belgium          0.1        0.8               0.9 Europe and Cent…
 3 2022-10-01 Belgium          0.1        0.4               0.4 Europe and Cent…
 4 2022-09-01 Belgium          0.2        0.4               0.6 Europe and Cent…
 5 2022-08-01 Belgium          0.1        0.6               0.7 Europe and Cent…
 6 2022-07-01 Belgium          0.2        1                 1.2 Europe and Cent…
 7 2022-06-01 Belgium          0.1        0.6               0.7 Europe and Cent…
 8 2022-05-01 Belgium          0.1        0.6               0.7 Europe and Cent…
 9 2022-04-01 Belgium          0.1        0.7               0.8 Europe and Cent…
10 2022-03-01 Belgium          0.3        1.4               1.8 Europe and Cent…
# … with 1,862 more rows</code></pre>
</div>
</div>
</section>
<section id="building-the-plot" class="level4">
<h4 class="anchored" data-anchor-id="building-the-plot">3.3.2 Building the plot</h4>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>pa <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> sgtrade_cln_ani,</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Import_SGD,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> Export_SGD,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> Region)) <span class="sc">+</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> Trade_Volumes_SGD),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.7</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope =</span> <span class="dv">1</span>,</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="fl">0.7</span>,</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.7</span>,</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">col =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> Countries,</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">group =</span> Countries),</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">show.legend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">45</span>)) <span class="sc">+</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Singapore Merchandise Export vs Import Trade Values from 2020 to 2022'</span>,</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Period: {format(frame_time, '%b %Y')}"</span>,</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">'Import (Billion SGD)'</span>, </span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Export (Billion SGD)'</span>) <span class="sc">+</span></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>, <span class="at">face =</span> <span class="st">"bold"</span>)) <span class="sc">+</span></span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_time</span>(Month_Year) <span class="sc">+</span> </span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ease_aes</span>(<span class="st">'linear'</span>) </span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(pa, </span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">duration =</span> <span class="dv">25</span>, <span class="co">#12 months/Year x 3 years x 0.7 sec/months = 18 seconds</span></span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">height =</span> <span class="dv">800</span>, </span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">800</span>,</span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">fps =</span> <span class="dv">30</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>