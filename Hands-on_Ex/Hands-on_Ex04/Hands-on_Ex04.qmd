---
title: "Hands-on Exercise 4: Fundamentals of Visual Analytics"
author: "Michael Djohan"
date: 02 February 2023
date-modified: "`r Sys.Date()`"
fontsize: smaller
execute: 
  echo: true
  eval: true
  warning: false
format: html
editor: visual
---

## 1. Getting Started

### Install and launching R packages.

The code chunk below uses p_load() of pacman package to check if packages are installed in the computer. If they are, then they will be launched into R. The R packages installed are:

-   [**ggstatsplot**](https://indrajeetpatil.github.io/ggstatsplot/) is an extension of [**ggplot2**](https://ggplot2.tidyverse.org/) package for creating graphics with details from statistical tests included in the information-rich plots themselves.

```{r}
pacman::p_load(ggstatsplot, tidyverse)
```

### Importing the data

```{r}
#| output: false
exam_data <- read_csv("data/Exam_data.csv")
```

## 2. Visual Statistical Analysis

### 2.1 One-sample test using `gghistostats` for

```{r}
set.seed(1234)

gghistostats(
  data = exam_data,
  x = ENGLISH,
  type = "bayes",
  test.value = 60,
  xlab = "English scores"
)
```

Default information: - statistical details - Bayes Factor - sample sizes - distribution summary

A Bayes factor is the ratio of the likelihood of one particular hypothesis to the likelihood of another. It can be interpreted as a measure of the strength of evidence in favor of one theory among two competing theories.

### 2.2 Two-sample mean test using `ggbetweenstats`

```{r}
ggbetweenstats(
  data = exam_data,
  x = GENDER,
  y = MATHS,
  type = "np",
  messages = FALSE
)
```

Default information: - statistical details - Bayes Factor - sample sizes - distribution summary

### 2.3 Oneway ANOVA Test using `ggbetweenstats`

```{r}
ggbetweenstats(
  data = exam_data, 
  x = RACE, 
  y = ENGLISH, 
  type = "p", 
  mean.ci = TRUE, 
  pairwise.comparisons = TRUE,
  #"ns" for only non-significant, "s" for only significant, "all" for everything
  pairwise.display = "s",      
  p.adjust.method = "fdr", 
  messages = FALSE 
  )
```

### 2.4 Significant Test of Correlation using `ggscatterstats`

```{r}
ggscatterstats(
  data = exam_data,
  x = MATHS,
  y = ENGLISH,
  marginal = FALSE
)
```

### 2.5 Significant Test of Association (Dependence) using `ggbarstats`

```{r}
#Binning Maths scores to 4-class variable
exam1 <- exam_data |> 
  mutate(MATHS_bins =
           cut(MATHS, 
               breaks = c(0, 60, 75, 85, 100)))
```

```{r}
ggbarstats(
  data = exam1,
  x = MATHS_bins,
  y = GENDER
)
```

## 3. Visualising Models

### 3.1 Preparation

```{r}
pacman::p_load(readxl, performance, parameters, see)
```

```{r}
car_resale <- read_xls("data/ToyotaCorolla.xls", 
                       "data")
```

### 3.2 Multiple Regression Model using `lm()`

Calibrate a multiple linear regression model by using lm() of Base Stats of R.

```{r}
model <- lm(Price ~ Age_08_04 + Mfg_Year + KM +
              Weight + Guarantee_Period, data = car_resale)
model
```

### 3.3 Checking for multicollinearity using `check_collinearity()`

```{r}
check_collinearity(model)
```

```{r}
#plot the collinearity
plot(check_collinearity(model))
```

Age_08_04 and Mfg_Year are highly correlated. Remove Mfg_Year

### 3.4 Checking for normality assumption using `check_normality()`

```{r}
#Remove Mfg_Year from model
model1 <- lm(Price ~ Age_08_04 + KM + 
              Weight + Guarantee_Period, data = car_resale)
```

```{r}
check_n <- check_normality(model1)
plot(check_n)
```

The analytical histogram above is specially designed for normality assumption test. When the residual histogram (in cyan colour) is not closed to the theoretical histogram (i.e in green), then we will reject the Null hypothesis and infer that the model residual failed to conform to normality assumption.

### 3.5 Checking for homogeneity of variances using `check_heteroscedasticity()`

```{r}
check_h <- check_heteroscedasticity(model1)
plot(check_h)
```

The analytical scatter plot is used to perform homogeneity of Variance assumption test. A constant variance distribution should be flat and horizontal and the data points should be scattered around the fit line. The chart above shows clear sign of heteroscedasticity.

### 3.6 Complete check using `check_model()`

```{r}
#| fig-height: 15
#| fig-width: 12.5
check_model(model1)
```

### 3.7 Visualising Regression Parameters

Using `plot()` and `parameters()`

```{r}
plot(parameters(model1))
```

Using [*ggcoefstats()*](https://indrajeetpatil.github.io/ggstatsplot/reference/ggcoefstats.html) of ggstatsplot package

```{r}
ggcoefstats(model1, 
            output = "plot")
```
